<!DOCTYPE html><html lang="C"><head><title>Architecture Analysis Report</title><meta property="og:title" content="Architecture Analysis Report"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><style>@media screen{body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button{appearance:none;background-color:initial;border:0;color:inherit;cursor:pointer;font-size:inherit;opacity:.8;outline:none;padding:0;transition:opacity .2s linear;-webkit-tap-highlight-color:transparent}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:disabled{cursor:not-allowed;opacity:.15!important}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover{opacity:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover:active{opacity:.6}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover:not(:disabled){transition:none}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-prev{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNjggOTAgMjggNTBsNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-next{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJtMzIgOTAgNDAtNDAtNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen]{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgeD0iMTAiIHk9IjIwIiBjbGFzcz0iYSIgcng9IjUuNjciLz48cGF0aCBkPSJNNDAgNzBIMjBWNTBtMjAgMEwyMCA3MG00MC00MGgyMHYyMG0tMjAgMCAyMC0yMCIgY2xhc3M9ImEiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen]{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgeD0iMTAiIHk9IjIwIiBjbGFzcz0iYSIgcng9IjUuNjciLz48cGF0aCBkPSJNMjAgNTBoMjB2MjBtLTIwIDAgMjAtMjBtNDAgMEg2MFYzMG0yMCAwTDYwIDUwIiBjbGFzcz0iYSIvPjwvc3ZnPg==")}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter]{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNODcuOCA0Ny41Qzg5IDUwIDg3LjcgNTIgODUgNTJIMzVhOC43IDguNyAwIDAgMS03LjItNC41bC0xNS42LTMxQzExIDE0IDEyLjIgMTIgMTUgMTJoNTBhOC44IDguOCAwIDAgMSA3LjIgNC41ek02MCA1MnYzNm0tMTAgMGgyME00NSA0MmgyMCIvPjwvc3ZnPg==") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button.bespoke-marp-presenter-note-bigger{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMTIgNTBoODBNNTIgOTBWMTAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button.bespoke-marp-presenter-note-smaller{background:#0000 url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMTIgNTBoODAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}}@keyframes __bespoke_marp_transition_reduced_outgoing__{0%{opacity:1}to{opacity:0}}@keyframes __bespoke_marp_transition_reduced_incoming__{0%{mix-blend-mode:plus-lighter;opacity:0}to{mix-blend-mode:plus-lighter;opacity:1}}.bespoke-marp-note,.bespoke-marp-osc,.bespoke-progress-parent{display:none;transition:none}@media screen{::view-transition-group(*){animation-duration:var(--marp-bespoke-transition-animation-duration,.5s);animation-timing-function:ease}::view-transition-new(*),::view-transition-old(*){animation-delay:0s;animation-direction:var(--marp-bespoke-transition-animation-direction,normal);animation-duration:var(--marp-bespoke-transition-animation-duration,.5s);animation-fill-mode:both;animation-name:var(--marp-bespoke-transition-animation-name,var(--marp-bespoke-transition-animation-name-fallback,__bespoke_marp_transition_no_animation__));mix-blend-mode:normal}::view-transition-old(*){--marp-bespoke-transition-animation-name-fallback:__bespoke_marp_transition_reduced_outgoing__;animation-timing-function:ease}::view-transition-new(*){--marp-bespoke-transition-animation-name-fallback:__bespoke_marp_transition_reduced_incoming__;animation-timing-function:ease}::view-transition-new(root),::view-transition-old(root){animation-timing-function:linear}::view-transition-new(__bespoke_marp_transition_osc__),::view-transition-old(__bespoke_marp_transition_osc__){animation-duration:0s!important;animation-name:__bespoke_marp_transition_osc__!important}::view-transition-new(__bespoke_marp_transition_osc__){opacity:0!important}.bespoke-marp-transition-warming-up::view-transition-group(*),.bespoke-marp-transition-warming-up::view-transition-new(*),.bespoke-marp-transition-warming-up::view-transition-old(*){animation-play-state:paused!important}body,html{height:100%;margin:0}body{background:#000;overflow:hidden}svg.bespoke-marp-slide{content-visibility:hidden;opacity:0;pointer-events:none;z-index:-1}svg.bespoke-marp-slide:not(.bespoke-marp-active) *{view-transition-name:none!important}svg.bespoke-marp-slide.bespoke-marp-active{content-visibility:visible;opacity:1;pointer-events:auto;z-index:0}svg.bespoke-marp-slide.bespoke-marp-active.bespoke-marp-active-ready *{animation-name:__bespoke_marp__!important}@supports not (content-visibility:hidden){svg.bespoke-marp-slide[data-bespoke-marp-load=hideable]{display:none}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable].bespoke-marp-active{display:block}}}@media screen and (prefers-reduced-motion:reduce){svg.bespoke-marp-slide *{view-transition-name:none!important}}@media screen{[data-bespoke-marp-fragment=inactive]{visibility:hidden}body[data-bespoke-view=""] .bespoke-marp-parent,body[data-bespoke-view=next] .bespoke-marp-parent{inset:0;position:absolute}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc{background:#000000a6;border-radius:7px;bottom:50px;color:#fff;contain:paint;display:block;font-family:Helvetica,Arial,sans-serif;font-size:16px;left:50%;line-height:0;opacity:1;padding:12px;position:absolute;touch-action:manipulation;transform:translateX(-50%);transition:opacity .2s linear;-webkit-user-select:none;user-select:none;white-space:nowrap;will-change:transform;z-index:1;view-transition-name:__bespoke_marp_transition_osc__}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>*,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>*{margin-left:6px}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>:first-child,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>:first-child{margin-left:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span{opacity:.8}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page]{display:inline-block;min-width:140px;text-align:center}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev]{height:32px;line-height:32px;width:32px}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive{cursor:none}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc{opacity:0;pointer-events:none}body[data-bespoke-view=""] svg.bespoke-marp-slide,body[data-bespoke-view=next] svg.bespoke-marp-slide{height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent{background:#222;display:flex;height:5px;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent+.bespoke-marp-parent{top:5px}body[data-bespoke-view=""] .bespoke-progress-parent .bespoke-progress-bar{background:#0288d1;flex:0 0 0;transition:flex-basis .2s cubic-bezier(0,1,1,1)}body[data-bespoke-view=next]{background:#0000}body[data-bespoke-view=presenter]{background:#161616}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container{display:grid;font-family:Helvetica,Arial,sans-serif;grid-template:"current dragbar next" minmax(140px,1fr) "current dragbar note" 2fr "info    dragbar note" 3em;grid-template-columns:minmax(3px,var(--bespoke-marp-presenter-split-ratio,66%)) 0 minmax(3px,1fr);height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent{grid-area:current;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide{height:calc(100% - 40px);left:20px;pointer-events:none;position:absolute;top:20px;-webkit-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide.bespoke-marp-active{filter:drop-shadow(0 3px 10px rgba(0,0,0,.5))}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container{background:#0288d1;cursor:col-resize;grid-area:dragbar;margin-left:-3px;opacity:0;position:relative;transition:opacity .4s linear .1s;width:6px;z-index:10}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container:hover{opacity:1}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container.active{opacity:1;transition-delay:0s}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container{background:#222;cursor:pointer;display:none;grid-area:next;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container iframe.bespoke-marp-presenter-next{background:#0000;border:0;display:block;filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));height:calc(100% - 40px);left:20px;pointer-events:none;position:absolute;top:20px;-webkit-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container{background:#222;color:#eee;grid-area:note;position:relative;z-index:1}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-wrapper{display:block;inset:0;position:absolute}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-buttons{background:#000000a6;border-radius:4px;bottom:0;display:flex;gap:4px;margin:12px;opacity:0;padding:6px;pointer-events:none;position:absolute;right:0;transition:opacity .2s linear}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-buttons:focus-within,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-wrapper:focus-within+.bespoke-marp-presenter-note-buttons,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container:hover .bespoke-marp-presenter-note-buttons{opacity:1;pointer-events:auto}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note{box-sizing:border-box;font-size:calc(1.1em*var(--bespoke-marp-note-font-scale, 1));height:calc(100% - 40px);margin:20px;overflow:auto;padding-right:3px;white-space:pre-wrap;width:calc(100% - 40px);word-wrap:break-word;scrollbar-color:#eeeeee80 #0000;scrollbar-width:thin}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar{width:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-track{background:#0000}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-thumb{background:#eeeeee80;border-radius:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note:empty{pointer-events:none}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:first-child{margin-top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:last-child{margin-bottom:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container{align-items:center;box-sizing:border-box;color:#eee;display:flex;flex-wrap:nowrap;grid-area:info;justify-content:center;overflow:hidden;padding:0 10px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{box-sizing:border-box;display:block;padding:0 10px;white-space:nowrap;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page{order:2;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page .bespoke-marp-presenter-info-page-text{display:inline-block;min-width:120px;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time{color:#999;order:1;text-align:left}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{color:#999;order:3;text-align:right}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer:hover{cursor:pointer}}@media print{.bespoke-marp-presenter-info-container,.bespoke-marp-presenter-next-container,.bespoke-marp-presenter-note-container{display:none}}</style><style>div#\:\$p > svg > foreignObject > section{width:1280px;height:720px;box-sizing:border-box;overflow:hidden;position:relative;scroll-snap-align:center center;-webkit-text-size-adjust:100%;text-size-adjust:100%}div#\:\$p > svg > foreignObject > section::after{bottom:0;content:attr(data-marpit-pagination);padding:inherit;pointer-events:none;position:absolute;right:0}div#\:\$p > svg > foreignObject > section:not([data-marpit-pagination])::after{display:none}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1){font-size:2em;margin-block:0.67em}div#\:\$p > svg > foreignObject > section video::-webkit-media-controls{will-change:transform}@page {size:1280px 720px;margin:0}@media print{html, body{background-color:#fff;margin:0;page-break-inside:avoid;break-inside:avoid-page}div#\:\$p > svg > foreignObject > section{page-break-before:always;break-before:page}div#\:\$p > svg > foreignObject > section, div#\:\$p > svg > foreignObject > section *{-webkit-print-color-adjust:exact!important;animation-delay:0s!important;animation-duration:0s!important;color-adjust:exact!important;print-color-adjust:exact!important;transition:none!important}div#\:\$p > svg[data-marpit-svg]{display:block;height:100vh;width:100vw}}div#\:\$p > svg > foreignObject > :where(section){container-type:size}div#\:\$p > svg > foreignObject > section img[data-marp-twemoji]{background:transparent;height:1em;margin:0 .05em 0 .1em;vertical-align:-.1em;width:1em}div#\:\$p > svg > foreignObject > section{--focus-outlineColor:light-dark(#0969da, #1f6feb);--fgColor-default:light-dark(#1f2328, #f0f6fc);--fgColor-muted:light-dark(#59636e, #9198a1);--fgColor-accent:light-dark(#0969da, #4493f8);--fgColor-success:light-dark(#1a7f37, #3fb950);--fgColor-attention:light-dark(#9a6700, #d29922);--fgColor-danger:light-dark(#d1242f, #f85149);--fgColor-done:light-dark(#8250df, #ab7df8);--bgColor-default:light-dark(#fff, #0d1117);--bgColor-muted:light-dark(#f6f8fa, #151b23);--bgColor-neutral-muted:light-dark(#818b981f, #656c7633);--bgColor-attention-muted:light-dark(#fff8c5, #bb800926);--borderColor-default:light-dark(#d1d9e0, #3d444d);--borderColor-muted:light-dark(#d1d9e0b3, #3d444db3);--borderColor-neutral-muted:light-dark(#d1d9e0b3, #3d444db3);--borderColor-accent-emphasis:light-dark(#0969da, #1f6feb);--borderColor-success-emphasis:light-dark(#1a7f37, #238636);--borderColor-attention-emphasis:light-dark(#9a6700, #9e6a03);--borderColor-danger-emphasis:light-dark(#cf222e, #da3633);--borderColor-done-emphasis:light-dark(#8250df, #8957e5);--color-prettylights-syntax-comment:light-dark(#59636e, #9198a1);--color-prettylights-syntax-constant:light-dark(#0550ae, #79c0ff);--color-prettylights-syntax-constant-other-reference-link:light-dark(#0a3069, #a5d6ff);--color-prettylights-syntax-entity:light-dark(#6639ba, #d2a8ff);--color-prettylights-syntax-storage-modifier-import:light-dark(#1f2328, #f0f6fc);--color-prettylights-syntax-entity-tag:light-dark(#0550ae, #7ee787);--color-prettylights-syntax-keyword:light-dark(#cf222e, #ff7b72);--color-prettylights-syntax-string:light-dark(#0a3069, #a5d6ff);--color-prettylights-syntax-variable:light-dark(#953800, #ffa657);--color-prettylights-syntax-brackethighlighter-unmatched:light-dark(#82071e, #f85149);--color-prettylights-syntax-brackethighlighter-angle:light-dark(#59636e, #9198a1);--color-prettylights-syntax-invalid-illegal-text:light-dark(#f6f8fa, #f0f6fc);--color-prettylights-syntax-invalid-illegal-bg:light-dark(#82071e, #8e1519);--color-prettylights-syntax-carriage-return-text:light-dark(#f6f8fa, #f0f6fc);--color-prettylights-syntax-carriage-return-bg:light-dark(#cf222e, #b62324);--color-prettylights-syntax-string-regexp:light-dark(#116329, #7ee787);--color-prettylights-syntax-markup-list:light-dark(#3b2300, #f2cc60);--color-prettylights-syntax-markup-heading:light-dark(#0550ae, #1f6feb);--color-prettylights-syntax-markup-italic:light-dark(#1f2328, #f0f6fc);--color-prettylights-syntax-markup-bold:light-dark(#1f2328, #f0f6fc);--color-prettylights-syntax-markup-deleted-text:light-dark(#82071e, #ffdcd7);--color-prettylights-syntax-markup-deleted-bg:light-dark(#ffebe9, #67060c);--color-prettylights-syntax-markup-inserted-text:light-dark(#116329, #aff5b4);--color-prettylights-syntax-markup-inserted-bg:light-dark(#dafbe1, #033a16);--color-prettylights-syntax-markup-changed-text:light-dark(#953800, #ffdfb6);--color-prettylights-syntax-markup-changed-bg:light-dark(#ffd8b5, #5a1e02);--color-prettylights-syntax-markup-ignored-text:light-dark(#d1d9e0, #f0f6fc);--color-prettylights-syntax-markup-ignored-bg:light-dark(#0550ae, #1158c7);--color-prettylights-syntax-meta-diff-range:light-dark(#8250df, #d2a8ff);--color-prettylights-syntax-sublimelinter-gutter-mark:light-dark(#818b98, #3d444d);--base-size-4:calc(var(--marpit-root-font-size, 1rem) * 0.25);--base-size-8:calc(var(--marpit-root-font-size, 1rem) * 0.5);--base-size-16:calc(var(--marpit-root-font-size, 1rem) * 1);--base-size-24:calc(var(--marpit-root-font-size, 1rem) * 1.5);--base-size-40:calc(var(--marpit-root-font-size, 1rem) * 2.5);--base-text-weight-normal:400;--base-text-weight-medium:500;--base-text-weight-semibold:600;--fontStack-monospace:ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;--fgColor-accent:Highlight;}/*!
 * Marp default theme.
 *
 * @theme default
 * @author Yuki Hattori
 *
 * @auto-scaling true
 * @size 16:9 1280px 720px
 * @size 4:3 960px 720px
 */div#\:\$p > svg > foreignObject > section [data-theme=light],div#\:\$p > svg > foreignObject > section{color-scheme:light}div#\:\$p > svg > foreignObject > section [data-theme=dark],div#\:\$p > svg > foreignObject > section:where(.invert){color-scheme:dark}div#\:\$p > svg > foreignObject > section{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;background-color:var(--bgColor-default);color:var(--fgColor-default);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Noto Sans,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;margin:0;word-wrap:break-word}div#\:\$p > svg > foreignObject > section{--marpit-root-font-size:16px}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1):hover .anchor .octicon-link:before,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2):hover .anchor .octicon-link:before,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3):hover .anchor .octicon-link:before,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4):hover .anchor .octicon-link:before,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5):hover .anchor .octicon-link:before,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6):hover .anchor .octicon-link:before{background-color:currentColor;content:" ";display:inline-block;height:16px;-webkit-mask-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 0 0 1.06 1.06l1.25-1.25a2 2 0 1 1 2.83 2.83l-2.5 2.5a2 2 0 0 1-2.83 0 .75.75 0 0 0-1.06 1.06 3.5 3.5 0 0 0 4.95 0l2.5-2.5a3.5 3.5 0 0 0-4.95-4.95zm-4.69 9.64a2 2 0 0 1 0-2.83l2.5-2.5a2 2 0 0 1 2.83 0 .75.75 0 0 0 1.06-1.06 3.5 3.5 0 0 0-4.95 0l-2.5 2.5a3.5 3.5 0 0 0 4.95 4.95l1.25-1.25a.75.75 0 0 0-1.06-1.06l-1.25 1.25a2 2 0 0 1-2.83 0"/></svg>');mask-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 0 0 1.06 1.06l1.25-1.25a2 2 0 1 1 2.83 2.83l-2.5 2.5a2 2 0 0 1-2.83 0 .75.75 0 0 0-1.06 1.06 3.5 3.5 0 0 0 4.95 0l2.5-2.5a3.5 3.5 0 0 0-4.95-4.95zm-4.69 9.64a2 2 0 0 1 0-2.83l2.5-2.5a2 2 0 0 1 2.83 0 .75.75 0 0 0 1.06-1.06 3.5 3.5 0 0 0-4.95 0l-2.5 2.5a3.5 3.5 0 0 0 4.95 4.95l1.25-1.25a.75.75 0 0 0-1.06-1.06l-1.25 1.25a2 2 0 0 1-2.83 0"/></svg>');width:16px}div#\:\$p > svg > foreignObject > section details,div#\:\$p > svg > foreignObject > section figcaption,div#\:\$p > svg > foreignObject > section figure{display:block}div#\:\$p > svg > foreignObject > section summary{display:list-item}div#\:\$p > svg > foreignObject > section [hidden]{display:none!important}div#\:\$p > svg > foreignObject > section a{background-color:transparent;color:var(--fgColor-accent);text-decoration:none}div#\:\$p > svg > foreignObject > section abbr[title]{border-bottom:none;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}div#\:\$p > svg > foreignObject > section b,div#\:\$p > svg > foreignObject > section strong{font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section dfn{font-style:italic}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1){border-bottom:1px solid var(--borderColor-muted);font-size:2em;font-weight:var(--base-text-weight-semibold, 600);margin:.67em 0;padding-bottom:.3em}div#\:\$p > svg > foreignObject > section mark{background-color:var(--bgColor-attention-muted);color:var(--fgColor-default)}div#\:\$p > svg > foreignObject > section small{font-size:90%}div#\:\$p > svg > foreignObject > section sub,div#\:\$p > svg > foreignObject > section sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}div#\:\$p > svg > foreignObject > section sub{bottom:-.25em}div#\:\$p > svg > foreignObject > section sup{top:-.5em}div#\:\$p > svg > foreignObject > section img{border-style:none;box-sizing:content-box;max-width:100%}div#\:\$p > svg > foreignObject > section code,div#\:\$p > svg > foreignObject > section kbd,div#\:\$p > svg > foreignObject > section :is(pre, marp-pre),div#\:\$p > svg > foreignObject > section samp{font-family:monospace;font-size:1em}div#\:\$p > svg > foreignObject > section figure{margin:1em var(--base-size-40)}div#\:\$p > svg > foreignObject > section hr{background:transparent;background-color:var(--borderColor-default);border:0;box-sizing:content-box;height:.25em;margin:var(--base-size-24) 0;overflow:hidden;padding:0}div#\:\$p > svg > foreignObject > section input{font:inherit;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible}div#\:\$p > svg > foreignObject > section [type=button],div#\:\$p > svg > foreignObject > section [type=reset],div#\:\$p > svg > foreignObject > section [type=submit]{-webkit-appearance:button;-moz-appearance:button;appearance:button}div#\:\$p > svg > foreignObject > section [type=checkbox],div#\:\$p > svg > foreignObject > section [type=radio]{box-sizing:border-box;padding:0}div#\:\$p > svg > foreignObject > section [type=number]::-webkit-inner-spin-button,div#\:\$p > svg > foreignObject > section [type=number]::-webkit-outer-spin-button{height:auto}div#\:\$p > svg > foreignObject > section [type=search]::-webkit-search-cancel-button,div#\:\$p > svg > foreignObject > section [type=search]::-webkit-search-decoration{-webkit-appearance:none;appearance:none}div#\:\$p > svg > foreignObject > section ::-webkit-input-placeholder{color:inherit;opacity:.54}div#\:\$p > svg > foreignObject > section ::-webkit-file-upload-button{-webkit-appearance:button;appearance:button;font:inherit}div#\:\$p > svg > foreignObject > section a:hover{text-decoration:underline}div#\:\$p > svg > foreignObject > section ::-moz-placeholder{color:var(--fgColor-muted);opacity:1}div#\:\$p > svg > foreignObject > section ::placeholder{color:var(--fgColor-muted);opacity:1}div#\:\$p > svg > foreignObject > section hr:after,div#\:\$p > svg > foreignObject > section hr:before{content:"";display:table}div#\:\$p > svg > foreignObject > section hr:after{clear:both}div#\:\$p > svg > foreignObject > section table{border-collapse:collapse;border-spacing:0;display:block;font-variant:tabular-nums;max-width:100%;overflow:auto;width:-moz-max-content;width:max-content}div#\:\$p > svg > foreignObject > section td,div#\:\$p > svg > foreignObject > section th{padding:0}div#\:\$p > svg > foreignObject > section details summary{cursor:pointer}div#\:\$p > svg > foreignObject > section [role=button]:focus,div#\:\$p > svg > foreignObject > section a:focus,div#\:\$p > svg > foreignObject > section input[type=checkbox]:focus,div#\:\$p > svg > foreignObject > section input[type=radio]:focus{box-shadow:none;outline:2px solid var(--focus-outlineColor);outline-offset:-2px}div#\:\$p > svg > foreignObject > section [role=button]:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section a:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section input[type=checkbox]:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section input[type=radio]:focus:not(:focus-visible){outline:1px solid transparent}div#\:\$p > svg > foreignObject > section [role=button]:focus-visible,div#\:\$p > svg > foreignObject > section a:focus-visible,div#\:\$p > svg > foreignObject > section input[type=checkbox]:focus-visible,div#\:\$p > svg > foreignObject > section input[type=radio]:focus-visible{box-shadow:none;outline:2px solid var(--focus-outlineColor);outline-offset:-2px}div#\:\$p > svg > foreignObject > section a:not([class]):focus,div#\:\$p > svg > foreignObject > section a:not([class]):focus-visible,div#\:\$p > svg > foreignObject > section input[type=checkbox]:focus,div#\:\$p > svg > foreignObject > section input[type=checkbox]:focus-visible,div#\:\$p > svg > foreignObject > section input[type=radio]:focus,div#\:\$p > svg > foreignObject > section input[type=radio]:focus-visible{outline-offset:0}div#\:\$p > svg > foreignObject > section kbd{background-color:var(--bgColor-muted);border-bottom-color:var(--borderColor-neutral-muted);border:1px solid var(--borderColor-neutral-muted);border-radius:6px;box-shadow:inset 0 -1px 0 var(--borderColor-neutral-muted);color:var(--fgColor-default);display:inline-block;font:11px var(--fontStack-monospace, ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace);line-height:10px;padding:var(--base-size-4);vertical-align:middle}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section :is(h2, marp-h2),div#\:\$p > svg > foreignObject > section :is(h3, marp-h3),div#\:\$p > svg > foreignObject > section :is(h4, marp-h4),div#\:\$p > svg > foreignObject > section :is(h5, marp-h5),div#\:\$p > svg > foreignObject > section :is(h6, marp-h6){font-weight:var(--base-text-weight-semibold, 600);line-height:1.25;margin-bottom:var(--base-size-16);margin-top:var(--base-size-24)}div#\:\$p > svg > foreignObject > section :is(h2, marp-h2){border-bottom:1px solid var(--borderColor-muted);font-size:1.5em;padding-bottom:.3em}div#\:\$p > svg > foreignObject > section :is(h2, marp-h2),div#\:\$p > svg > foreignObject > section :is(h3, marp-h3){font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section :is(h3, marp-h3){font-size:1.25em}div#\:\$p > svg > foreignObject > section :is(h4, marp-h4){font-size:1em}div#\:\$p > svg > foreignObject > section :is(h4, marp-h4),div#\:\$p > svg > foreignObject > section :is(h5, marp-h5){font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section :is(h5, marp-h5){font-size:.875em}div#\:\$p > svg > foreignObject > section :is(h6, marp-h6){color:var(--fgColor-muted);font-size:.85em;font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section p{margin-bottom:10px;margin-top:0}div#\:\$p > svg > foreignObject > section blockquote{border-left:.25em solid var(--borderColor-default);color:var(--fgColor-muted);margin:0;padding:0 1em}div#\:\$p > svg > foreignObject > section ol,div#\:\$p > svg > foreignObject > section ul{margin-bottom:0;margin-top:0;padding-left:2em}div#\:\$p > svg > foreignObject > section ol ol,div#\:\$p > svg > foreignObject > section ul ol{list-style-type:lower-roman}div#\:\$p > svg > foreignObject > section ol ol ol,div#\:\$p > svg > foreignObject > section ol ul ol,div#\:\$p > svg > foreignObject > section ul ol ol,div#\:\$p > svg > foreignObject > section ul ul ol{list-style-type:lower-alpha}div#\:\$p > svg > foreignObject > section dd{margin-left:0}div#\:\$p > svg > foreignObject > section code,div#\:\$p > svg > foreignObject > section :is(pre, marp-pre),div#\:\$p > svg > foreignObject > section samp,div#\:\$p > svg > foreignObject > section tt{font-family:var(--fontStack-monospace, ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace);font-size:12px}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre){margin-bottom:0;margin-top:0;word-wrap:normal}div#\:\$p > svg > foreignObject > section .octicon{display:inline-block;fill:currentColor;overflow:visible!important;vertical-align:text-bottom}div#\:\$p > svg > foreignObject > section input::-webkit-inner-spin-button,div#\:\$p > svg > foreignObject > section input::-webkit-outer-spin-button{-webkit-appearance:none;appearance:none;margin:0}div#\:\$p > svg > foreignObject > section .mr-2{margin-right:var(--base-size-8, 8px)!important}div#\:\$p > svg > foreignObject > section:after,div#\:\$p > svg > foreignObject > section:before{display:table}div#\:\$p > svg > foreignObject > section:after{clear:both}div#\:\$p > svg > foreignObject > section>:first-child{margin-top:0!important}div#\:\$p > svg > foreignObject > section>:last-child{margin-bottom:0!important}div#\:\$p > svg > foreignObject > section a:not([href]){color:inherit;text-decoration:none}div#\:\$p > svg > foreignObject > section .absent{color:var(--fgColor-danger)}div#\:\$p > svg > foreignObject > section .anchor{float:left;line-height:1;margin-left:-20px;padding-right:var(--base-size-4)}div#\:\$p > svg > foreignObject > section .anchor:focus{outline:none}div#\:\$p > svg > foreignObject > section blockquote,div#\:\$p > svg > foreignObject > section details,div#\:\$p > svg > foreignObject > section dl,div#\:\$p > svg > foreignObject > section ol,div#\:\$p > svg > foreignObject > section p,div#\:\$p > svg > foreignObject > section :is(pre, marp-pre),div#\:\$p > svg > foreignObject > section table,div#\:\$p > svg > foreignObject > section ul{margin-bottom:var(--base-size-16);margin-top:0}div#\:\$p > svg > foreignObject > section blockquote>:first-child{margin-top:0}div#\:\$p > svg > foreignObject > section blockquote>:last-child{margin-bottom:0}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1) .octicon-link,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2) .octicon-link,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3) .octicon-link,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4) .octicon-link,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5) .octicon-link,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6) .octicon-link{color:var(--fgColor-default);vertical-align:middle;visibility:hidden}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1):hover .anchor,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2):hover .anchor,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3):hover .anchor,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4):hover .anchor,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5):hover .anchor,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6):hover .anchor{text-decoration:none}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1):hover .anchor .octicon-link,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2):hover .anchor .octicon-link,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3):hover .anchor .octicon-link,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4):hover .anchor .octicon-link,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5):hover .anchor .octicon-link,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6):hover .anchor .octicon-link{visibility:visible}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1) code,div#\:\$p > svg > foreignObject > section :is(h1, marp-h1) tt,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2) code,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2) tt,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3) code,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3) tt,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4) code,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4) tt,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5) code,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5) tt,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6) code,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6) tt{font-size:inherit;padding:0 .2em}div#\:\$p > svg > foreignObject > section summary :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section summary :is(h2, marp-h2),div#\:\$p > svg > foreignObject > section summary :is(h3, marp-h3),div#\:\$p > svg > foreignObject > section summary :is(h4, marp-h4),div#\:\$p > svg > foreignObject > section summary :is(h5, marp-h5),div#\:\$p > svg > foreignObject > section summary :is(h6, marp-h6){display:inline-block}div#\:\$p > svg > foreignObject > section summary :is(h1, marp-h1) .anchor,div#\:\$p > svg > foreignObject > section summary :is(h2, marp-h2) .anchor,div#\:\$p > svg > foreignObject > section summary :is(h3, marp-h3) .anchor,div#\:\$p > svg > foreignObject > section summary :is(h4, marp-h4) .anchor,div#\:\$p > svg > foreignObject > section summary :is(h5, marp-h5) .anchor,div#\:\$p > svg > foreignObject > section summary :is(h6, marp-h6) .anchor{margin-left:-40px}div#\:\$p > svg > foreignObject > section summary :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section summary :is(h2, marp-h2){border-bottom:0;padding-bottom:0}div#\:\$p > svg > foreignObject > section ol.no-list,div#\:\$p > svg > foreignObject > section ul.no-list{list-style-type:none;padding:0}div#\:\$p > svg > foreignObject > section ol[type="a s"]{list-style-type:lower-alpha}div#\:\$p > svg > foreignObject > section ol[type="A s"]{list-style-type:upper-alpha}div#\:\$p > svg > foreignObject > section ol[type="i s"]{list-style-type:lower-roman}div#\:\$p > svg > foreignObject > section ol[type="I s"]{list-style-type:upper-roman}div#\:\$p > svg > foreignObject > section div>ol:not([type]),div#\:\$p > svg > foreignObject > section ol[type="1"]{list-style-type:decimal}div#\:\$p > svg > foreignObject > section ol ol,div#\:\$p > svg > foreignObject > section ol ul,div#\:\$p > svg > foreignObject > section ul ol,div#\:\$p > svg > foreignObject > section ul ul{margin-bottom:0;margin-top:0}div#\:\$p > svg > foreignObject > section li>p{margin-top:var(--base-size-16)}div#\:\$p > svg > foreignObject > section li+li{margin-top:.25em}div#\:\$p > svg > foreignObject > section dl{padding:0}div#\:\$p > svg > foreignObject > section dl dt{font-size:1em;font-style:italic;font-weight:var(--base-text-weight-semibold, 600);margin-top:var(--base-size-16);padding:0}div#\:\$p > svg > foreignObject > section dl dd{margin-bottom:var(--base-size-16);padding:0 var(--base-size-16)}div#\:\$p > svg > foreignObject > section table th{font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section table td,div#\:\$p > svg > foreignObject > section table th{border:1px solid var(--borderColor-default);padding:6px 13px}div#\:\$p > svg > foreignObject > section table td>:last-child{margin-bottom:0}div#\:\$p > svg > foreignObject > section table tr{background-color:var(--bgColor-default);border-top:1px solid var(--borderColor-muted)}div#\:\$p > svg > foreignObject > section table tr:nth-child(2n){background-color:var(--bgColor-muted)}div#\:\$p > svg > foreignObject > section table img{background-color:transparent}div#\:\$p > svg > foreignObject > section img[align=right]{padding-left:20px}div#\:\$p > svg > foreignObject > section img[align=left]{padding-right:20px}div#\:\$p > svg > foreignObject > section .emoji{background-color:transparent;max-width:none;vertical-align:text-top}div#\:\$p > svg > foreignObject > section :is(span, marp-span).frame,div#\:\$p > svg > foreignObject > section :is(span, marp-span).frame>:is(span, marp-span){display:block;overflow:hidden}div#\:\$p > svg > foreignObject > section :is(span, marp-span).frame>:is(span, marp-span){border:1px solid var(--borderColor-default);float:left;margin:13px 0 0;padding:7px;width:auto}div#\:\$p > svg > foreignObject > section :is(span, marp-span).frame :is(span, marp-span) img{display:block;float:left}div#\:\$p > svg > foreignObject > section :is(span, marp-span).frame :is(span, marp-span) :is(span, marp-span){clear:both;color:var(--fgColor-default);display:block;padding:5px 0 0}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-center{clear:both;display:block;overflow:hidden}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-center>:is(span, marp-span){display:block;margin:13px auto 0;overflow:hidden;text-align:center}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-center :is(span, marp-span) img{margin:0 auto;text-align:center}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-right{clear:both;display:block;overflow:hidden}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-right>:is(span, marp-span){display:block;margin:13px 0 0;overflow:hidden;text-align:right}div#\:\$p > svg > foreignObject > section :is(span, marp-span).align-right :is(span, marp-span) img{margin:0;text-align:right}div#\:\$p > svg > foreignObject > section :is(span, marp-span).float-left{display:block;float:left;margin-right:13px;overflow:hidden}div#\:\$p > svg > foreignObject > section :is(span, marp-span).float-left :is(span, marp-span){margin:13px 0 0}div#\:\$p > svg > foreignObject > section :is(span, marp-span).float-right{display:block;float:right;margin-left:13px;overflow:hidden}div#\:\$p > svg > foreignObject > section :is(span, marp-span).float-right>:is(span, marp-span){display:block;margin:13px auto 0;overflow:hidden;text-align:right}div#\:\$p > svg > foreignObject > section code,div#\:\$p > svg > foreignObject > section tt{background-color:var(--bgColor-neutral-muted);border-radius:6px;font-size:85%;margin:0;padding:.2em .4em;white-space:break-spaces}div#\:\$p > svg > foreignObject > section code br,div#\:\$p > svg > foreignObject > section tt br{display:none}div#\:\$p > svg > foreignObject > section del code{text-decoration:inherit}div#\:\$p > svg > foreignObject > section samp{font-size:85%}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) code{font-size:100%}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre)>code{background:transparent;border:0;margin:0;padding:0;white-space:pre;word-break:normal}div#\:\$p > svg > foreignObject > section .highlight{margin-bottom:var(--base-size-16)}div#\:\$p > svg > foreignObject > section .highlight :is(pre, marp-pre){margin-bottom:0;word-break:normal}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre){background-color:var(--bgColor-muted);border-radius:6px;color:var(--fgColor-default);font-size:85%;line-height:1.45;overflow:auto;padding:var(--base-size-16)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) code,div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) tt{display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0;word-wrap:normal;background-color:transparent;border:0}div#\:\$p > svg > foreignObject > section .csv-data td,div#\:\$p > svg > foreignObject > section .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}div#\:\$p > svg > foreignObject > section .csv-data .blob-num{background:var(--bgColor-default);border:0;padding:10px var(--base-size-8) 9px;text-align:right}div#\:\$p > svg > foreignObject > section .csv-data tr{border-top:0}div#\:\$p > svg > foreignObject > section .csv-data th{background:var(--bgColor-muted);border-top:0;font-weight:var(--base-text-weight-semibold, 600)}div#\:\$p > svg > foreignObject > section [data-footnote-ref]:before{content:"["}div#\:\$p > svg > foreignObject > section [data-footnote-ref]:after{content:"]"}div#\:\$p > svg > foreignObject > section .footnotes{border-top:1px solid var(--borderColor-default);color:var(--fgColor-muted);font-size:12px}div#\:\$p > svg > foreignObject > section div#\:\$p > svg > foreignObject > section section.footnotes{--marpit-root-font-size:12px}div#\:\$p > svg > foreignObject > section .footnotes ol,div#\:\$p > svg > foreignObject > section .footnotes ol ul{padding-left:var(--base-size-16)}div#\:\$p > svg > foreignObject > section .footnotes ol ul{display:inline-block;margin-top:var(--base-size-16)}div#\:\$p > svg > foreignObject > section .footnotes li{position:relative}div#\:\$p > svg > foreignObject > section .footnotes li:target:before{border:2px solid var(--borderColor-accent-emphasis);border-radius:6px;bottom:calc(var(--base-size-8)*-1);content:"";left:calc(var(--base-size-24)*-1);pointer-events:none;position:absolute;right:calc(var(--base-size-8)*-1);top:calc(var(--base-size-8)*-1)}div#\:\$p > svg > foreignObject > section .footnotes li:target{color:var(--fgColor-default)}div#\:\$p > svg > foreignObject > section .footnotes .data-footnote-backref g-emoji{font-family:monospace}div#\:\$p > svg > foreignObject > section body:has(:modal){padding-right:var(--dialog-scrollgutter)!important}div#\:\$p > svg > foreignObject > section .pl-c{color:var(--color-prettylights-syntax-comment)}div#\:\$p > svg > foreignObject > section .pl-c1,div#\:\$p > svg > foreignObject > section .pl-s .pl-v{color:var(--color-prettylights-syntax-constant)}div#\:\$p > svg > foreignObject > section .pl-e,div#\:\$p > svg > foreignObject > section .pl-en{color:var(--color-prettylights-syntax-entity)}div#\:\$p > svg > foreignObject > section .pl-s .pl-s1,div#\:\$p > svg > foreignObject > section .pl-smi{color:var(--color-prettylights-syntax-storage-modifier-import)}div#\:\$p > svg > foreignObject > section .pl-ent{color:var(--color-prettylights-syntax-entity-tag)}div#\:\$p > svg > foreignObject > section .pl-k{color:var(--color-prettylights-syntax-keyword)}div#\:\$p > svg > foreignObject > section .pl-pds,div#\:\$p > svg > foreignObject > section .pl-s,div#\:\$p > svg > foreignObject > section .pl-s .pl-pse .pl-s1,div#\:\$p > svg > foreignObject > section .pl-sr,div#\:\$p > svg > foreignObject > section .pl-sr .pl-cce,div#\:\$p > svg > foreignObject > section .pl-sr .pl-sra,div#\:\$p > svg > foreignObject > section .pl-sr .pl-sre{color:var(--color-prettylights-syntax-string)}div#\:\$p > svg > foreignObject > section .pl-smw,div#\:\$p > svg > foreignObject > section .pl-v{color:var(--color-prettylights-syntax-variable)}div#\:\$p > svg > foreignObject > section .pl-bu{color:var(--color-prettylights-syntax-brackethighlighter-unmatched)}div#\:\$p > svg > foreignObject > section .pl-ii{background-color:var(--color-prettylights-syntax-invalid-illegal-bg);color:var(--color-prettylights-syntax-invalid-illegal-text)}div#\:\$p > svg > foreignObject > section .pl-c2{background-color:var(--color-prettylights-syntax-carriage-return-bg);color:var(--color-prettylights-syntax-carriage-return-text)}div#\:\$p > svg > foreignObject > section .pl-sr .pl-cce{color:var(--color-prettylights-syntax-string-regexp);font-weight:700}div#\:\$p > svg > foreignObject > section .pl-ml{color:var(--color-prettylights-syntax-markup-list)}div#\:\$p > svg > foreignObject > section .pl-mh,div#\:\$p > svg > foreignObject > section .pl-mh .pl-en,div#\:\$p > svg > foreignObject > section .pl-ms{color:var(--color-prettylights-syntax-markup-heading);font-weight:700}div#\:\$p > svg > foreignObject > section .pl-mi{color:var(--color-prettylights-syntax-markup-italic);font-style:italic}div#\:\$p > svg > foreignObject > section .pl-mb{color:var(--color-prettylights-syntax-markup-bold);font-weight:700}div#\:\$p > svg > foreignObject > section .pl-md{background-color:var(--color-prettylights-syntax-markup-deleted-bg);color:var(--color-prettylights-syntax-markup-deleted-text)}div#\:\$p > svg > foreignObject > section .pl-mi1{background-color:var(--color-prettylights-syntax-markup-inserted-bg);color:var(--color-prettylights-syntax-markup-inserted-text)}div#\:\$p > svg > foreignObject > section .pl-mc{background-color:var(--color-prettylights-syntax-markup-changed-bg);color:var(--color-prettylights-syntax-markup-changed-text)}div#\:\$p > svg > foreignObject > section .pl-mi2{background-color:var(--color-prettylights-syntax-markup-ignored-bg);color:var(--color-prettylights-syntax-markup-ignored-text)}div#\:\$p > svg > foreignObject > section .pl-mdr{color:var(--color-prettylights-syntax-meta-diff-range);font-weight:700}div#\:\$p > svg > foreignObject > section .pl-ba{color:var(--color-prettylights-syntax-brackethighlighter-angle)}div#\:\$p > svg > foreignObject > section .pl-sg{color:var(--color-prettylights-syntax-sublimelinter-gutter-mark)}div#\:\$p > svg > foreignObject > section .pl-corl{color:var(--color-prettylights-syntax-constant-other-reference-link);text-decoration:underline}div#\:\$p > svg > foreignObject > section [role=button]:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section [role=tabpanel][tabindex="0"]:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section a:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section button:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section summary:focus:not(:focus-visible){box-shadow:none;outline:none}div#\:\$p > svg > foreignObject > section [tabindex="0"]:focus:not(:focus-visible),div#\:\$p > svg > foreignObject > section details-dialog:focus:not(:focus-visible){outline:none}div#\:\$p > svg > foreignObject > section g-emoji{display:inline-block;font-family:Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:1em;font-style:normal!important;font-weight:var(--base-text-weight-normal, 400);line-height:1;min-width:1ch;vertical-align:-.075em}div#\:\$p > svg > foreignObject > section g-emoji img{height:1em;width:1em}div#\:\$p > svg > foreignObject > section .task-list-item{list-style-type:none}div#\:\$p > svg > foreignObject > section .task-list-item label{font-weight:var(--base-text-weight-normal, 400)}div#\:\$p > svg > foreignObject > section .task-list-item.enabled label{cursor:pointer}div#\:\$p > svg > foreignObject > section .task-list-item+.task-list-item{margin-top:var(--base-size-4)}div#\:\$p > svg > foreignObject > section .task-list-item .handle{display:none}div#\:\$p > svg > foreignObject > section .task-list-item-checkbox{margin:0 .2em .25em -1.4em;vertical-align:middle}div#\:\$p > svg > foreignObject > section ul:dir(rtl) .task-list-item-checkbox{margin:0 -1.6em .25em .2em}div#\:\$p > svg > foreignObject > section ol:dir(rtl) .task-list-item-checkbox{margin:0 -1.6em .25em .2em}div#\:\$p > svg > foreignObject > section .contains-task-list:focus-within .task-list-item-convert-container,div#\:\$p > svg > foreignObject > section .contains-task-list:hover .task-list-item-convert-container{display:block;height:24px;overflow:visible;width:auto;clip:auto}div#\:\$p > svg > foreignObject > section ::-webkit-calendar-picker-indicator{filter:invert(50%)}div#\:\$p > svg > foreignObject > section .markdown-alert{border-left:.25em solid var(--borderColor-default);color:inherit;margin-bottom:var(--base-size-16);padding:var(--base-size-8) var(--base-size-16)}div#\:\$p > svg > foreignObject > section .markdown-alert>:first-child{margin-top:0}div#\:\$p > svg > foreignObject > section .markdown-alert>:last-child{margin-bottom:0}div#\:\$p > svg > foreignObject > section .markdown-alert .markdown-alert-title{align-items:center;display:flex;font-weight:var(--base-text-weight-medium, 500);line-height:1}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-note{border-left-color:var(--borderColor-accent-emphasis)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-note .markdown-alert-title{color:var(--fgColor-accent)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-important{border-left-color:var(--borderColor-done-emphasis)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-important .markdown-alert-title{color:var(--fgColor-done)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-warning{border-left-color:var(--borderColor-attention-emphasis)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-warning .markdown-alert-title{color:var(--fgColor-attention)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-tip{border-left-color:var(--borderColor-success-emphasis)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-tip .markdown-alert-title{color:var(--fgColor-success)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-caution{border-left-color:var(--borderColor-danger-emphasis)}div#\:\$p > svg > foreignObject > section .markdown-alert.markdown-alert-caution .markdown-alert-title{color:var(--fgColor-danger)}div#\:\$p > svg > foreignObject > section>:first-child>.heading-element:first-child{margin-top:0!important}div#\:\$p > svg > foreignObject > section .highlight :is(pre, marp-pre):has(+.zeroclipboard-container){min-height:52px}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1){color:var(--h1-color);font-size:1.6em}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section :is(h2, marp-h2){border-bottom:none}div#\:\$p > svg > foreignObject > section :is(h2, marp-h2){font-size:1.3em}div#\:\$p > svg > foreignObject > section :is(h3, marp-h3){font-size:1.1em}div#\:\$p > svg > foreignObject > section :is(h4, marp-h4){font-size:1.05em}div#\:\$p > svg > foreignObject > section :is(h5, marp-h5){font-size:1em}div#\:\$p > svg > foreignObject > section :is(h6, marp-h6){font-size:.9em}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1) strong,div#\:\$p > svg > foreignObject > section :is(h2, marp-h2) strong,div#\:\$p > svg > foreignObject > section :is(h3, marp-h3) strong,div#\:\$p > svg > foreignObject > section :is(h4, marp-h4) strong,div#\:\$p > svg > foreignObject > section :is(h5, marp-h5) strong,div#\:\$p > svg > foreignObject > section :is(h6, marp-h6) strong{color:var(--heading-strong-color);font-weight:inherit}div#\:\$p > svg > foreignObject > section :is(h1, marp-h1)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h2, marp-h2)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h3, marp-h3)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h4, marp-h4)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h5, marp-h5)::part(auto-scaling),div#\:\$p > svg > foreignObject > section :is(h6, marp-h6)::part(auto-scaling){max-height:563px}div#\:\$p > svg > foreignObject > section hr{height:0;padding-top:.25em}div#\:\$p > svg > foreignObject > section img{background-color:transparent}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre){border:1px solid var(--borderColor-default);line-height:1.15;overflow:visible}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre)::part(auto-scaling){max-height:529px}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs){color:var(--color-prettylights-syntax-storage-modifier-import)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-doctag),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-keyword),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-meta .hljs-keyword),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-template-tag),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-template-variable),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-type),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-variable.language_){color:var(--color-prettylights-syntax-keyword)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-title),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-title.class_),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-title.class_.inherited__),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-title.function_){color:var(--color-prettylights-syntax-entity)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-attr),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-attribute),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-literal),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-meta),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-number),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-operator),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-selector-attr),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-selector-class),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-selector-id),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-variable){color:var(--color-prettylights-syntax-constant)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-meta .hljs-string),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-regexp),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-string){color:var(--color-prettylights-syntax-string)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-built_in),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-symbol){color:var(--color-prettylights-syntax-variable)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-code),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-comment),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-formula){color:var(--color-prettylights-syntax-comment)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-name),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-quote),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-selector-pseudo),div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-selector-tag){color:var(--color-prettylights-syntax-entity-tag)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-subst){color:var(--color-prettylights-syntax-storage-modifier-import)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-section){color:var(--color-prettylights-syntax-markup-heading);font-weight:700}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-bullet){color:var(--color-prettylights-syntax-markup-list)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-emphasis){color:var(--color-prettylights-syntax-markup-italic);font-style:italic}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-strong){color:var(--color-prettylights-syntax-markup-bold);font-weight:700}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-addition){background-color:var(--color-prettylights-syntax-markup-inserted-bg);color:var(--color-prettylights-syntax-markup-inserted-text)}div#\:\$p > svg > foreignObject > section :is(pre, marp-pre) :where(.hljs-deletion){background-color:var(--color-prettylights-syntax-markup-deleted-bg);color:var(--color-prettylights-syntax-markup-deleted-text)}div#\:\$p > svg > foreignObject > section footer,div#\:\$p > svg > foreignObject > section header{color:var(--header-footer-color);font-size:18px;left:30px;margin:0;position:absolute}div#\:\$p > svg > foreignObject > section header{top:21px}div#\:\$p > svg > foreignObject > section footer{bottom:21px}div#\:\$p > svg > foreignObject > section{--h1-color:light-dark(#246, #cee7ff);--header-footer-color:light-dark(hsla(0,0%,40%,.75), hsla(0,0%,60%,.75));--heading-strong-color:light-dark(#48c, #7bf);--paginate-color:light-dark(#777, #999);--base-size-4:4px;--base-size-8:8px;--base-size-16:16px;--base-size-24:24px;--base-size-40:40px;align-items:stretch;display:block;flex-flow:column nowrap;font-size:29px;height:720px;padding:78.5px;place-content:safe center center;width:1280px}div#\:\$p > svg > foreignObject > section{--marpit-root-font-size:29px}div#\:\$p > svg > foreignObject > section>:last-child,div#\:\$p > svg > foreignObject > section[data-footer]>:nth-last-child(2){margin-bottom:0}div#\:\$p > svg > foreignObject > section>:first-child,div#\:\$p > svg > foreignObject > section>header:first-child+*{margin-top:0}div#\:\$p > svg > foreignObject > section:after{bottom:21px;color:var(--paginate-color);font-size:24px;padding:0;position:absolute;right:30px}div#\:\$p > svg > foreignObject > section:after{--marpit-root-font-size:24px}div#\:\$p > svg > foreignObject > section[data-color] :is(h1, marp-h1),div#\:\$p > svg > foreignObject > section[data-color] :is(h2, marp-h2),div#\:\$p > svg > foreignObject > section[data-color] :is(h3, marp-h3),div#\:\$p > svg > foreignObject > section[data-color] :is(h4, marp-h4),div#\:\$p > svg > foreignObject > section[data-color] :is(h5, marp-h5),div#\:\$p > svg > foreignObject > section[data-color] :is(h6, marp-h6){color:currentcolor}div#\:\$p > svg > foreignObject > section{overflow:auto;font-size:calc(var(--marpit-root-font-size, 1rem) * 0.9)}div#\:\$p > svg > foreignObject > section{--marpit-root-font-size: calc(var(--marpit-root-font-size, 1rem) * 0.9)}div#\:\$p > svg > foreignObject > section::before{display:none}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"]{columns:initial!important;display:block!important;padding:0!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"]::before, div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"]::after, div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="content"]::before, div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="content"]::after{display:none!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container]{all:initial;display:flex;flex-direction:row;height:100%;overflow:hidden;width:100%}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container][data-marpit-advanced-background-direction="vertical"]{flex-direction:column}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"][data-marpit-advanced-background-split] > div[data-marpit-advanced-background-container]{width:var(--marpit-advanced-background-split, 50%)}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"][data-marpit-advanced-background-split="right"] > div[data-marpit-advanced-background-container]{margin-left:calc(100% - var(--marpit-advanced-background-split, 50%))}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container] > figure{all:initial;background-position:center;background-repeat:no-repeat;background-size:cover;flex:auto;margin:0}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="background"] > div[data-marpit-advanced-background-container] > figure > figcaption{position:absolute;border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;white-space:nowrap;width:1px}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="content"], div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="pseudo"]{background:transparent!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background="pseudo"], div#\:\$p > svg[data-marpit-svg] > foreignObject[data-marpit-advanced-background="pseudo"]{pointer-events:none!important}div#\:\$p > svg > foreignObject > section[data-marpit-advanced-background-split]{width:100%;height:100%}
</style></head><body><div class="bespoke-marp-osc"><button data-bespoke-marp-osc="prev" tabindex="-1" title="Previous slide">Previous slide</button><span data-bespoke-marp-osc="page"></span><button data-bespoke-marp-osc="next" tabindex="-1" title="Next slide">Next slide</button><button data-bespoke-marp-osc="fullscreen" tabindex="-1" title="Toggle fullscreen (f)">Toggle fullscreen</button><button data-bespoke-marp-osc="presenter" tabindex="-1" title="Open presenter view (p)">Open presenter view</button></div><div id=":$p"><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="1" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h1 id="architecture-analysis-report">Architecture Analysis Report</h1>
<p><strong>Project:</strong> Undisclosed React Native<br />
<strong>Date:</strong> 2025-11-19<br />
<strong>Analysis Scope:</strong> Clean Architecture implementation in <code>/src</code></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="2" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="executive-summary">Executive Summary</h2>
<h3 id="key-findings">Key Findings</h3>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Strengths:</strong></p>
<ul>
<li>Clear 4-layer architecture with proper dependency inversion</li>
<li>Well-defined domain entities with no framework dependencies</li>
<li>Repository pattern successfully abstracts Firebase and Sanity</li>
<li>24 use cases provide solid application orchestration</li>
<li>Dependency injection (tsyringe) enables testability</li>
</ul>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/26a0.svg" data-marp-twemoji=""/> <strong>Critical Issues:</strong></p>
<ul>
<li><strong>24 use cases</strong> are coupled to Redux Toolkit (<code>createAsyncThunk</code>)</li>
<li><strong>StateManager</strong> is misplaced in Application layer (should be Presentation)</li>
<li><strong>3 dependency violations</strong> where Application imports from Presentation</li>
<li>Use cases are not framework-agnostic (cannot be reused outside Redux)</li>
</ul>
<h3 id="recommendations">Recommendations</h3>
<ol>
<li><strong>Keep 4-layer architecture</strong> - appropriate complexity level for this application</li>
<li><strong>Decouple use cases from Redux</strong> - move thunks to Presentation layer</li>
<li><strong>Relocate StateManager</strong> from <code>application/</code> to <code>presentation/state/</code></li>
<li><strong>Fix cross-layer imports</strong> - move shared types to proper locations</li>
</ol>
<p><strong>Estimated Impact:</strong> High value, low-to-medium migration effort</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="3" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#1-current-architecture-overview">Current Architecture Overview</a></li>
<li><a href="#2-layer-by-layer-analysis">Layer-by-Layer Analysis</a></li>
<li><a href="#3-dependency-violations">Dependency Violations</a></li>
<li><a href="#4-di-container-usage-analysis">DI Container Usage Analysis</a></li>
<li><a href="#5-redux-integration-problem">Redux Integration Problem</a></li>
<li><a href="#6-recommended-architecture">Recommended Architecture</a></li>
<li><a href="#7-migration-strategy">Migration Strategy</a></li>
<li><a href="#8-code-examples">Code Examples</a></li>
<li><a href="#9-decision-framework">Decision Framework</a></li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="4" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="1-current-architecture-overview">1. Current Architecture Overview</h2>
<h3 id="layer-statistics">Layer Statistics</h3>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Files (TS/TSX)</th>
<th>Purpose</th>
<th>Dependencies</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Domain</strong></td>
<td>38</td>
<td>Entities, Value Objects, Repository Interfaces</td>
<td>None <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/></td>
</tr>
<tr>
<td><strong>Application</strong></td>
<td>109</td>
<td>Use Cases (24), Services, StateManager, Types</td>
<td>Domain <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/></td>
</tr>
<tr>
<td><strong>Infrastructure</strong></td>
<td>51</td>
<td>Firebase/Sanity implementations</td>
<td>Domain, Application <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/></td>
</tr>
<tr>
<td><strong>Presentation</strong></td>
<td>59</td>
<td>ViewModels (hooks), Components</td>
<td>Domain, Application <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/></td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> DI container (<code>container.ts</code>) lives outside the 4-layer structure as a &quot;bootstrap&quot; concern. Legacy code resides in <code>src/old/</code>.</p>
<h3 id="dependency-flow">Dependency Flow</h3>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>
         Presentation Layer               
   (ViewModels, Components, Screens)      
          59 TS/TSX files                 

                depends on
               

         Application Layer                
  (Use Cases, Services, StateManager)     
          109 TS files                    

            depends on
           

          Domain Layer                    
    (Entities, Value Objects)             
          38 TS files                     

           
            implements
           

        Infrastructure Layer              
     (Firebase, Sanity implementations)   
          51 TS files                     


  DI Container (container.ts) - outside layers
  Legacy code (src/old/) - being phased out
</code></pre>
<h3 id="import-analysis">Import Analysis</h3>
<table>
<thead>
<tr>
<th>Import Direction</th>
<th>Count</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Application  Domain</td>
<td>147</td>
<td><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Expected</td>
</tr>
<tr>
<td>Presentation  Application</td>
<td>41</td>
<td><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Expected</td>
</tr>
<tr>
<td>Infrastructure  Domain</td>
<td>10+</td>
<td><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Expected</td>
</tr>
<tr>
<td><strong>Application  Presentation</strong></td>
<td><strong>3</strong></td>
<td><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> <strong>VIOLATION</strong></td>
</tr>
<tr>
<td><strong>Application  Infrastructure</strong></td>
<td><strong>1</strong></td>
<td><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> <strong>VIOLATION</strong></td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="5" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="2-layer-by-layer-analysis">2. Layer-by-Layer Analysis</h2>
<h3 id="21-domain-layer-%E2%9C%85-excellent">2.1 Domain Layer <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> EXCELLENT</h3>
<p><strong>Location:</strong> <code>src/domain/</code></p>
<p><strong>Contents:</strong></p>
<ul>
<li>38 TypeScript files</li>
<li>Entities: <code>LifeContext</code>, <code>Pregnancy</code>, <code>Menstruation</code>, <code>Parent</code>, <code>Abortion</code></li>
<li>Value Objects: <code>Week</code>, <code>DateRange</code>, <code>MetricLog</code></li>
<li>Repository Interfaces (contracts)</li>
</ul>
<p><strong>Quality Assessment:</strong></p>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Strengths:</strong></p>
<ul>
<li>Pure TypeScript - no framework dependencies</li>
<li>Well-defined entity hierarchy</li>
<li>Uses value objects appropriately</li>
<li>Repository interfaces define clear contracts</li>
</ul>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Example - Clean Entity:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/domain/entities/LifeContext/LifeContext.entity.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">LifeContextEntity</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-title class_">LifeContextId</span>;
  <span class="hljs-attr">type</span>: <span class="hljs-title class_">LifeContextType</span>;
  <span class="hljs-attr">startDate</span>: <span class="hljs-title class_">Date</span>;
  <span class="hljs-attr">endDate</span>?: <span class="hljs-title class_">Date</span>;
  <span class="hljs-attr">isActive</span>: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-attr">metadata</span>?: <span class="hljs-title class_">LifeContextMetadata</span>;
  <span class="hljs-title function_">getMetadata</span>(): <span class="hljs-title class_">LifeContextMetadata</span>;
  <span class="hljs-title function_">setId</span>(<span class="hljs-attr">id</span>: <span class="hljs-title class_">LifeContextId</span>): <span class="hljs-built_in">void</span>;
};
</code></pre>
<p><strong>No changes needed</strong> - this layer is well-architected.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="6" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="22-application-layer-%E2%9A%A0%EF%B8%8F-needs-improvement">2.2 Application Layer <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/26a0.svg" data-marp-twemoji=""/> NEEDS IMPROVEMENT</h3>
<p><strong>Location:</strong> <code>src/application/</code></p>
<p><strong>Contents:</strong></p>
<ul>
<li>109 TypeScript files</li>
<li><strong>24 Use Cases</strong> (business workflows)</li>
<li>8 Application Services</li>
<li>Types and constants</li>
<li><strong>StateManager/</strong> (Redux store, slices, listeners)</li>
</ul>
<p><strong>Quality Assessment:</strong></p>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Strengths:</strong></p>
<ul>
<li>Clear use case abstraction</li>
<li>Dependency injection throughout</li>
<li>Services encapsulate complex logic</li>
<li>147 imports from Domain (proper dependency)</li>
</ul>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> <strong>Problems:</strong></p>
<ol>
<li>
<p><strong>Use Cases Coupled to Redux</strong></p>
<ul>
<li>All 24 use cases return <code>createAsyncThunk</code></li>
<li>Cannot test without Redux</li>
<li>Cannot reuse in different contexts (CLI, scripts, etc.)</li>
</ul>
</li>
<li>
<p><strong>StateManager Misplaced</strong></p>
<ul>
<li>Redux is a delivery mechanism (Presentation concern)</li>
<li><code>StateManager/</code> should be in <code>presentation/state/</code></li>
<li>13 slice files mixed with application logic</li>
</ul>
</li>
<li>
<p><strong>Cross-Layer Violations</strong></p>
<ul>
<li>Imports <code>MetricWithValue</code> from Presentation layer</li>
<li>Creates circular dependency risk</li>
</ul>
</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="7" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="23-infrastructure-layer-%E2%9C%85-good">2.3 Infrastructure Layer <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> GOOD</h3>
<p><strong>Location:</strong> <code>src/infrastructure/</code></p>
<p><strong>Contents:</strong></p>
<ul>
<li>51 TypeScript files</li>
<li>Firebase repository implementations</li>
<li>Sanity repository implementations</li>
<li>Serializers and mappers</li>
</ul>
<p><strong>Note:</strong> DI container has been moved to <code>src/container.ts</code> (outside the 4 layers) as it's a bootstrap/wiring concern that touches all layers.</p>
<p><strong>Quality Assessment:</strong></p>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Strengths:</strong></p>
<ul>
<li>Clean implementation of repository interfaces</li>
<li>Proper use of dependency injection</li>
<li>Firebase/Sanity details hidden behind abstractions</li>
<li>Serializers handle data transformation</li>
</ul>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Example - Repository Implementation:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/infrastructure/firebase/LifeContext/LifeContextRepositoryImpl.firebase.ts</span>
<span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LifeContextRepositoryImplFirebase</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LifeContextRepository</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAll</span>(<span class="hljs-attr">userId</span>?: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">LifeContext</span>[]&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">firestore</span>()
      .<span class="hljs-title function_">collection</span>(<span class="hljs-string">&#x27;moduleUserData&#x27;</span>)
      .<span class="hljs-title function_">where</span>(<span class="hljs-string">&#x27;uids&#x27;</span>, <span class="hljs-string">&#x27;array-contains&#x27;</span>, uid)
      .<span class="hljs-title function_">get</span>()
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">querySnapshot</span> =&gt;</span> <span class="hljs-comment">/* ... */</span>);
  }
}
</code></pre>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/26a0.svg" data-marp-twemoji=""/> <strong>Minor Issue:</strong></p>
<ul>
<li>Container imports from <code>screens/</code> (presentation concern)</li>
<li>Should move hormone generators to application/services</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="8" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="24-presentation-layer-%E2%9C%85-good-structure">2.4 Presentation Layer <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> GOOD STRUCTURE</h3>
<p><strong>Location:</strong> <code>src/presentation/</code></p>
<p><strong>Contents:</strong></p>
<ul>
<li>59 TypeScript/TSX files</li>
<li>ViewModels (custom hooks)</li>
<li>Calendar components</li>
<li>Metric tracking components</li>
<li>Shared UI utilities</li>
</ul>
<p><strong>Quality Assessment:</strong></p>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Strengths:</strong></p>
<ul>
<li>ViewModels properly orchestrate use cases</li>
<li>Clean separation from UI components</li>
<li>41 imports from Application (proper dependency)</li>
</ul>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Example - ViewModel:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/presentation/viewModels/LifeContext/useLifeContext.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useLifeContext</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useAppDispatch</span>();
  <span class="hljs-keyword">const</span> getLifeContextUseCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>);

  <span class="hljs-keyword">const</span> loadLifeContexts = <span class="hljs-title function_">useCallback</span>(<span class="hljs-title function_">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">dispatch</span>(getLifeContextUseCase.<span class="hljs-title function_">execute</span>()).<span class="hljs-title function_">unwrap</span>();
  }, [dispatch, getLifeContextUseCase]);

  <span class="hljs-keyword">return</span> { loadLifeContexts <span class="hljs-comment">/* ... */</span> };
};
</code></pre>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/26a0.svg" data-marp-twemoji=""/> <strong>Missing:</strong></p>
<ul>
<li>StateManager should be here, not in Application layer</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="9" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="3-dependency-violations">3. Dependency Violations</h2>
<h3 id="violation-1-application-%E2%86%92-presentation-type-import">Violation 1: Application  Presentation (Type Import)</h3>
<p><strong>Severity:</strong> Medium<br />
<strong>Occurrences:</strong> 3 files</p>
<p><strong>Files Affected:</strong></p>
<ul>
<li><code>src/application/services/CalendarEventService.ts</code></li>
<li><code>src/application/useCases/insight/GetInsight.usecase.ts</code></li>
</ul>
<p><strong>Problem:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// Application layer importing from Presentation layer</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MetricWithValue</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/presentation/components/MetricLog/TrackingUtils&quot;</span>;
</code></pre>
<p><strong>Impact:</strong></p>
<ul>
<li>Breaks dependency inversion principle</li>
<li>Application layer depends on UI layer</li>
<li>Cannot test application logic without presentation</li>
</ul>
<p><strong>Fix:</strong><br />
Move <code>MetricWithValue</code> type to <code>src/application/types/metrics/</code></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="10" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="violation-2-infrastructure-%E2%86%92-presentation-di-container">Violation 2: Infrastructure  Presentation (DI Container)</h3>
<p><strong>Severity:</strong> Medium<br />
<strong>Occurrences:</strong> 1 file</p>
<p><strong>File Affected:</strong></p>
<ul>
<li><code>src/infrastructure/di/container.ts</code></li>
</ul>
<p><strong>Problem:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// Infrastructure importing from Screens</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">HormoneDataGeneratorFactory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/screens/StatusTab/Today/Chart/...&quot;</span>;
</code></pre>
<p><strong>Impact:</strong></p>
<ul>
<li>DI container (infrastructure) depends on screens (presentation)</li>
<li>Screens should not contain business logic</li>
</ul>
<p><strong>Fix:</strong><br />
Move hormone generator classes to <code>src/application/services/</code></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="11" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="violation-3-use-cases-%E2%86%92-redux-framework-coupling">Violation 3: Use Cases  Redux (Framework Coupling)</h3>
<p><strong>Severity:</strong> HIGH<br />
<strong>Occurrences:</strong> 24 use case files</p>
<p><strong>Problem:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// Use case tightly coupled to Redux Toolkit</span>
<span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveMetricLogsUseCase</span> {
  execute = createAsyncThunk&lt;<span class="hljs-title class_">SuccessMessage</span>, <span class="hljs-title class_">Params</span>, { <span class="hljs-attr">rejectValue</span>: <span class="hljs-built_in">string</span> }&gt;(
    <span class="hljs-string">&quot;metricLog/saveLogs&quot;</span>,
    <span class="hljs-title function_">async</span> ({ logDate, inserts, deletes }, { rejectWithValue }) =&gt; {
      <span class="hljs-comment">// business logic here</span>
    },
  );
}
</code></pre>
<p><strong>Impact:</strong></p>
<ul>
<li>Use cases cannot be tested without Redux</li>
<li>Use cases cannot be reused in CLI tools, scripts, or workers</li>
<li>Application layer depends on specific state management library</li>
<li>Violates framework-agnostic principle of Clean Architecture</li>
</ul>
<p><strong>This is the PRIMARY issue to address.</strong></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="12" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="4-di-container-usage-analysis">4. DI Container Usage Analysis</h2>
<h3 id="current-di-statistics">Current DI Statistics</h3>
<ul>
<li><strong>77 instances</strong> of <code>@injectable/@inject</code> across 42 files</li>
<li><strong>51 files</strong> using <code>container.resolve()</code></li>
</ul>
<h3 id="where-di-is-used">Where DI is Used</h3>
<table>
<thead>
<tr>
<th>Category</th>
<th>Files</th>
<th>DI Justified?</th>
</tr>
</thead>
<tbody>
<tr>
<td>Repositories</td>
<td>12</td>
<td><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Yes - need to swap implementations</td>
</tr>
<tr>
<td>Use Cases</td>
<td>24</td>
<td><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Yes - inject repositories/services</td>
</tr>
<tr>
<td>Stateful Services</td>
<td>6</td>
<td><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/26a0.svg" data-marp-twemoji=""/> Maybe - could be pure functions</td>
</tr>
<tr>
<td>Stateless Services</td>
<td>8</td>
<td><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> No - should be plain functions</td>
</tr>
</tbody>
</table>
<h3 id="di-benefits-realized">DI Benefits Realized</h3>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Testing:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// Easy to mock dependencies</span>
<span class="hljs-keyword">const</span> mockRepository = jest.<span class="hljs-title function_">fn</span>() <span class="hljs-keyword">as</span> jest.<span class="hljs-property">Mocked</span>&lt;<span class="hljs-title class_">LifeContextRepository</span>&gt;;
container.<span class="hljs-title function_">registerInstance</span>(<span class="hljs-string">&quot;LifeContextRepository&quot;</span>, mockRepository);
<span class="hljs-keyword">const</span> useCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>);
</code></pre>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Abstraction:</strong></p>
<ul>
<li>Firebase implementation can be swapped for Supabase</li>
<li>Can create mock implementations for development</li>
</ul>
<h3 id="di-costs">DI Costs</h3>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> <strong>Bundle Size:</strong></p>
<ul>
<li><code>tsyringe</code>: ~7KB gzipped</li>
<li><code>reflect-metadata</code>: ~50KB gzipped</li>
<li><strong>Total:</strong> ~57KB</li>
</ul>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> <strong>Complexity:</strong></p>
<ul>
<li>200 lines in <code>container.ts</code></li>
<li>Team training required</li>
<li>Boilerplate in every class</li>
</ul>
<h3 id="recommendation">Recommendation</h3>
<p><strong>Keep DI for:</strong></p>
<ul>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Repositories (clear value)</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Use Cases (orchestration)</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Stateful services with dependencies</li>
</ul>
<p><strong>Remove DI from:</strong></p>
<ul>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> Pure utility functions (<code>DateRangeService</code>)</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> Static services (<code>UserAuthService</code>)</li>
</ul>
<p><strong>Net Assessment:</strong> DI is providing value, but could be streamlined.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="13" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="5-redux-integration-problem">5. Redux Integration Problem</h2>
<h3 id="current-pattern-problematic">Current Pattern (Problematic)</h3>
<p><strong>Use Case with Embedded Thunk:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/application/useCases/lifeContext/GetLifeContext.useCase.ts</span>
<span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetLifeContextUseCase</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@inject</span>(<span class="hljs-string">&quot;LifeContextRepository&quot;</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">LifeContextRepository</span>,
  </span>) {}

  execute = createAsyncThunk&lt;
    <span class="hljs-title class_">ResultType</span>,
    <span class="hljs-built_in">void</span>,
    { <span class="hljs-attr">rejectValue</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">state</span>: <span class="hljs-title class_">RootState</span> }
  &gt;(<span class="hljs-string">&quot;lifeContext/getLifeContext&quot;</span>, <span class="hljs-title function_">async</span> (_, { getState, rejectWithValue }) =&gt; {
    <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">getState</span>();
    <span class="hljs-keyword">const</span> uid = <span class="hljs-title class_">UserAuthService</span>.<span class="hljs-title function_">getAuthenticatedUid</span>(state);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> contexts = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">getAll</span>(uid);
      <span class="hljs-comment">// ... business logic</span>
      <span class="hljs-keyword">return</span> { contexts, activePregnancy, activeMenstruation };
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejectWithValue</span>(error.<span class="hljs-property">message</span>);
    }
  });
}
</code></pre>
<p><strong>How Slices Consume:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/application/StateManager/slices/lifeContext/lifeContextSlice.ts</span>
<span class="hljs-keyword">const</span> lifeContextSlice = <span class="hljs-title function_">createSlice</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;lifeContext&quot;</span>,
  initialState,
  <span class="hljs-attr">reducers</span>: {},
  <span class="hljs-attr">extraReducers</span>: <span class="hljs-function">(<span class="hljs-params">builder</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> getLifeContextThunk = container.<span class="hljs-title function_">resolve</span>(
      <span class="hljs-title class_">GetLifeContextUseCase</span>,
    ).<span class="hljs-property">execute</span>;

    builder.<span class="hljs-title function_">addCase</span>(getLifeContextThunk.<span class="hljs-property">pending</span>, <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
      state.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>;
    });
    builder.<span class="hljs-title function_">addCase</span>(getLifeContextThunk.<span class="hljs-property">fulfilled</span>, <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
      state.<span class="hljs-property">contexts</span> = action.<span class="hljs-property">payload</span>.<span class="hljs-property">contexts</span>;
    });
  },
});
</code></pre>
<h3 id="problems-with-current-pattern">Problems with Current Pattern</h3>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> <strong>1. Framework Lock-in</strong></p>
<ul>
<li>Use cases can ONLY be used with Redux</li>
<li>Cannot call from:
<ul>
<li>CLI scripts</li>
<li>Background workers</li>
<li>Server-side rendering</li>
<li>Other state management libraries</li>
</ul>
</li>
</ul>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> <strong>2. Testing Complexity</strong></p>
<ul>
<li>Must mock Redux store</li>
<li>Must mock <code>getState()</code>, <code>rejectWithValue()</code></li>
<li>Cannot test business logic in isolation</li>
</ul>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> <strong>3. Mixed Responsibilities</strong></p>
<ul>
<li>Use case contains both:
<ul>
<li>Business logic (repository calls, data transformation)</li>
<li>State management logic (Redux thunk wrapper)</li>
</ul>
</li>
</ul>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> <strong>4. Architectural Violation</strong></p>
<ul>
<li>Application layer depends on Presentation framework</li>
<li>Violates Clean Architecture's framework-agnostic principle</li>
</ul>
<h3 id="impact-on-all-24-use-cases">Impact on All 24 Use Cases</h3>
<p><strong>All affected use cases:</strong></p>
<ol>
<li>GetLifeContextUseCase</li>
<li>InitiateMenstruationLifeContextUseCase</li>
<li>RestartMenstruationLifeContextUseCase</li>
<li>CalculateMenstrualCyclesUseCase</li>
<li>UpdateMenstrualPhaseLengthsDataUseCase</li>
<li>RecomputeAfterLifeContextChangeUseCase</li>
<li>SaveMenstruationOnboardingDataUseCase</li>
<li>SaveMetricLogsUseCase</li>
<li>ListMetricLogsUseCase</li>
<li>ListMetricCategoriesUseCase</li>
<li>ListBleedingLogsUseCase</li>
<li>GetStatusModeUseCase</li>
<li>ShouldShowCycleTrackingPromptUseCase</li>
<li>ClosePostPartumsUseCase</li>
<li>SetSicknessAndAilmentsUseCase</li>
<li>SetSexualActivityUseCase</li>
<li>SetPhysicalActivityUseCase</li>
<li>SetDrugUseUseCase</li>
<li>SetBirthControlUseCase</li>
<li>SetActivityFrequencyUseCase</li>
<li>GetInsightUseCase</li>
<li>GetCarefeedItemsUseCase</li>
<li>GetCarefeedFiltersUseCase</li>
<li>SetUserInterestsUseCase</li>
</ol>
<p><strong>All 24 need refactoring.</strong></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="14" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="6-recommended-architecture">6. Recommended Architecture</h2>
<h3 id="61-proposed-layer-structure">6.1 Proposed Layer Structure</h3>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>src/
 container.ts               # DI container (bootstrap, outside layers)
 old/                       # Legacy code being phased out

 domain/                    # Core business rules (NO CHANGES)
    entities/
    repositories/          # Interfaces only
    types/

 application/               # Application orchestration (DECOUPLE FROM REDUX)
    useCases/              #  Pure business logic (return Promise)
    services/              #  Application services
    repositories/          #  Repository interfaces
    types/                 #  Shared types (move MetricWithValue here)

 infrastructure/            # External integrations (MINOR FIXES)
    firebase/              # Firebase implementations
    sanity/                # Sanity implementations

 presentation/              # UI and state management (ADD STATE)
     state/                 #  MOVE StateManager here
        slices/            # Redux slices + thunks
        listeners/         # Redux listeners
        store.ts           # Store configuration
     viewModels/            # React hooks
     components/            # UI components
     screens/               # Screens (legacy)
</code></pre>
<p><strong>DI Container Location:</strong> <code>src/container.ts</code> sits outside the 4-layer structure because it's a &quot;bootstrap&quot; concern that wires together all layers. It's not business logic (Application), not external services (Infrastructure), not UI (Presentation), and not domain rules (Domain). It's infrastructure for the infrastructure.</p>
<h3 id="62-decoupled-use-case-pattern">6.2 Decoupled Use Case Pattern</h3>
<p><strong>New Pattern - Use Case (Framework-Agnostic):</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/application/useCases/lifeContext/GetLifeContext.useCase.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GetLifeContextResult</span> {
  <span class="hljs-attr">contexts</span>: <span class="hljs-title class_">LifeContext</span>[];
  <span class="hljs-attr">contextSequence</span>: <span class="hljs-title class_">LifeContextSequenceElement</span>[];
  <span class="hljs-attr">activePregnancy</span>: <span class="hljs-title class_">LifeContextId</span> | <span class="hljs-literal">undefined</span>;
  <span class="hljs-attr">activeMenstruation</span>: <span class="hljs-title class_">LifeContextId</span> | <span class="hljs-literal">undefined</span>;
}

<span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetLifeContextUseCase</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@inject</span>(<span class="hljs-string">&quot;LifeContextRepository&quot;</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">LifeContextRepository</span>,
    <span class="hljs-meta">@inject</span>(<span class="hljs-string">&quot;LifeContextSequenceService&quot;</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">sequenceService</span>: <span class="hljs-title class_">LifeContextSequenceService</span>,
  </span>) {}

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-attr">uid</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">GetLifeContextResult</span>&gt; {
    <span class="hljs-keyword">const</span> contexts = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">getAll</span>(uid);

    <span class="hljs-keyword">const</span> activePregnancy = contexts.<span class="hljs-title function_">find</span>(
      <span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span>
        <span class="hljs-title function_">isPregnancy</span>(c.<span class="hljs-property">context</span>) &amp;&amp;
        c.<span class="hljs-property">context</span>.<span class="hljs-property">isActive</span> &amp;&amp;
        !c.<span class="hljs-property">context</span>.<span class="hljs-property">metadata</span>.<span class="hljs-property">abortion</span>,
    )?.<span class="hljs-property">context</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Pregnancy</span> | <span class="hljs-literal">undefined</span>;

    <span class="hljs-keyword">const</span> activeMenstruation = contexts.<span class="hljs-title function_">find</span>(
      <span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> <span class="hljs-title function_">isMenstruation</span>(c.<span class="hljs-property">context</span>) &amp;&amp; c.<span class="hljs-property">context</span>.<span class="hljs-property">isActive</span>,
    )?.<span class="hljs-property">context</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Menstruation</span> | <span class="hljs-literal">undefined</span>;

    <span class="hljs-keyword">const</span> contextSequence = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sequenceService</span>.<span class="hljs-title function_">createSequence</span>(contexts);

    <span class="hljs-keyword">return</span> {
      contexts,
      contextSequence,
      <span class="hljs-attr">activePregnancy</span>: activePregnancy?.<span class="hljs-property">id</span>,
      <span class="hljs-attr">activeMenstruation</span>: activeMenstruation?.<span class="hljs-property">id</span>,
    };
  }
}
</code></pre>
<p><strong>Redux Integration (Presentation Layer):</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/presentation/state/slices/lifeContext/lifeContext.thunks.ts</span>
<span class="hljs-keyword">import</span> { createAsyncThunk } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;
<span class="hljs-keyword">import</span> { container } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;tsyringe&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GetLifeContextUseCase</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/application/useCases/lifeContext/GetLifeContext.useCase&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RootState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../store&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserAuthService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/application/services/UserAuthService&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchLifeContext = createAsyncThunk&lt;
  <span class="hljs-title class_">GetLifeContextResult</span>,
  <span class="hljs-built_in">void</span>,
  { <span class="hljs-attr">rejectValue</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">state</span>: <span class="hljs-title class_">RootState</span> }
&gt;(<span class="hljs-string">&quot;lifeContext/fetch&quot;</span>, <span class="hljs-title function_">async</span> (_, { getState, rejectWithValue }) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">getState</span>();
    <span class="hljs-keyword">const</span> uid = <span class="hljs-title class_">UserAuthService</span>.<span class="hljs-title function_">getAuthenticatedUid</span>(state);

    <span class="hljs-keyword">const</span> useCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> useCase.<span class="hljs-title function_">execute</span>(uid);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejectWithValue</span>(
      error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">&quot;Failed to fetch life contexts&quot;</span>,
    );
  }
});
</code></pre>
<p><strong>Redux Slice:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/presentation/state/slices/lifeContext/lifeContext.slice.ts</span>
<span class="hljs-keyword">import</span> { createSlice } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;
<span class="hljs-keyword">import</span> { fetchLifeContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./lifeContext.thunks&quot;</span>;

<span class="hljs-keyword">const</span> lifeContextSlice = <span class="hljs-title function_">createSlice</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;lifeContext&quot;</span>,
  initialState,
  <span class="hljs-attr">reducers</span>: {},
  <span class="hljs-attr">extraReducers</span>: <span class="hljs-function">(<span class="hljs-params">builder</span>) =&gt;</span> {
    builder
      .<span class="hljs-title function_">addCase</span>(fetchLifeContext.<span class="hljs-property">pending</span>, <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
        state.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>;
        state.<span class="hljs-property">error</span> = <span class="hljs-literal">null</span>;
      })
      .<span class="hljs-title function_">addCase</span>(fetchLifeContext.<span class="hljs-property">fulfilled</span>, <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
        state.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
        state.<span class="hljs-property">contexts</span> = action.<span class="hljs-property">payload</span>.<span class="hljs-property">contexts</span>.<span class="hljs-title function_">reduce</span>(
          <span class="hljs-function">(<span class="hljs-params">acc, context</span>) =&gt;</span> {
            acc[context.<span class="hljs-property">context</span>.<span class="hljs-property">id</span>] = context;
            <span class="hljs-keyword">return</span> acc;
          },
          {} <span class="hljs-keyword">as</span> { [<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-title class_">LifeContext</span> },
        );
        state.<span class="hljs-property">contextSequence</span> = action.<span class="hljs-property">payload</span>.<span class="hljs-property">contextSequence</span>;
        state.<span class="hljs-property">currentPregnancy</span> = action.<span class="hljs-property">payload</span>.<span class="hljs-property">activePregnancy</span> ?? <span class="hljs-literal">null</span>;
        state.<span class="hljs-property">currentMenstruation</span> = action.<span class="hljs-property">payload</span>.<span class="hljs-property">activeMenstruation</span> ?? <span class="hljs-literal">null</span>;
      })
      .<span class="hljs-title function_">addCase</span>(fetchLifeContext.<span class="hljs-property">rejected</span>, <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
        state.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
        state.<span class="hljs-property">error</span> = action.<span class="hljs-property">payload</span> || <span class="hljs-string">&quot;Failed to fetch life contexts&quot;</span>;
      });
  },
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> lifeContextSlice.<span class="hljs-property">reducer</span>;
</code></pre>
<h3 id="63-benefits-of-decoupled-pattern">6.3 Benefits of Decoupled Pattern</h3>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Framework-Agnostic Use Cases</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// Can call from anywhere - no Redux needed!</span>
<span class="hljs-keyword">const</span> useCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>);
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> useCase.<span class="hljs-title function_">execute</span>(uid);
</code></pre>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Easier Testing</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// No Redux mocking required</span>
<span class="hljs-keyword">const</span> mockRepo = <span class="hljs-title function_">createMockRepository</span>();
<span class="hljs-keyword">const</span> useCase = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GetLifeContextUseCase</span>(mockRepo, mockService);
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> useCase.<span class="hljs-title function_">execute</span>(<span class="hljs-string">&quot;test-uid&quot;</span>);
<span class="hljs-title function_">expect</span>(result.<span class="hljs-property">contexts</span>).<span class="hljs-title function_">toHaveLength</span>(<span class="hljs-number">2</span>);
</code></pre>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Better Separation of Concerns</strong></p>
<ul>
<li>Use Case: Business logic only</li>
<li>Thunk: Redux integration only</li>
<li>Slice: State updates only</li>
</ul>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Reusability</strong></p>
<ul>
<li>Use cases can be called from:
<ul>
<li>React components (via Redux)</li>
<li>Node.js scripts</li>
<li>CLI tools</li>
<li>Background workers</li>
<li>Other state management (Zustand, MobX)</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="15" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="7-migration-strategy">7. Migration Strategy</h2>
<h3 id="phase-1-quick-wins-week-1-%F0%9F%8E%AF">Phase 1: Quick Wins (Week 1) <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/1f3af.svg" data-marp-twemoji=""/></h3>
<p><strong>Priority: HIGH | Effort: LOW</strong></p>
<h4 id="11-fix-type-import-violations">1.1 Fix Type Import Violations</h4>
<p><strong>Task:</strong> Move <code>MetricWithValue</code> to Application layer</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-bash"><span class="hljs-comment"># From:</span>
src/presentation/components/MetricLog/TrackingUtils.ts

<span class="hljs-comment"># To:</span>
src/application/types/metrics/MetricWithValue.ts
</code></pre>
<p><strong>Files to Update:</strong> 3 files</p>
<ul>
<li><code>application/services/CalendarEventService.ts</code></li>
<li><code>application/useCases/insight/GetInsight.usecase.ts</code></li>
<li><code>presentation/components/MetricLog/TrackingUtils.ts</code></li>
</ul>
<p><strong>Estimated Time:</strong> 30 minutes</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="16" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="12-move-statemanager-to-presentation">1.2 Move StateManager to Presentation</h4>
<p><strong>Task:</strong> Relocate Redux state management</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-bash"><span class="hljs-comment"># From:</span>
src/application/StateManager/

<span class="hljs-comment"># To:</span>
src/presentation/state/
</code></pre>
<p><strong>Structure:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>src/presentation/state/
 slices/
    lifeContext/
    metricLog/
    insight/
    user/
 listeners/
 store.ts
</code></pre>
<p><strong>Files to Move:</strong> 19 files (13 slices + 4 listeners + 2 config)</p>
<p><strong>Update Imports:</strong> ~50 files reference <code>@/application/StateManager</code></p>
<p><strong>Estimated Time:</strong> 2-3 hours</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="17" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="phase-2-decouple-use-cases-weeks-2-3-%F0%9F%8E%AF">Phase 2: Decouple Use Cases (Weeks 2-3) <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/1f3af.svg" data-marp-twemoji=""/></h3>
<p><strong>Priority: HIGH | Effort: MEDIUM</strong></p>
<h4 id="21-create-thunk-files">2.1 Create Thunk Files</h4>
<p><strong>For each of 24 use cases, create corresponding thunk file:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>src/presentation/state/thunks/
 lifeContext.thunks.ts        # GetLifeContext, Initiate, Restart, etc.
 metricLog.thunks.ts          # SaveLogs, ListLogs, etc.
 myHealth.thunks.ts           # SetBirthControl, SetDrugUse, etc.
 carefeed.thunks.ts           # GetCarefeedItems, GetFilters
 insight.thunks.ts            # GetInsight
 onboarding.thunks.ts         # SaveOnboardingData
</code></pre>
<p><strong>Pattern for Each Thunk:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// presentation/state/thunks/lifeContext.thunks.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchLifeContext = <span class="hljs-title function_">createAsyncThunk</span>(
  <span class="hljs-string">&quot;lifeContext/fetch&quot;</span>,
  <span class="hljs-title function_">async</span> (_, { getState, rejectWithValue }) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> uid = <span class="hljs-title function_">selectAuthenticatedUid</span>(<span class="hljs-title function_">getState</span>());
      <span class="hljs-keyword">const</span> useCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> useCase.<span class="hljs-title function_">execute</span>(uid);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejectWithValue</span>(error.<span class="hljs-property">message</span>);
    }
  },
);
</code></pre>
<p><strong>Estimated Time:</strong> 6-8 hours (24 thunks  15-20 min each)</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="18" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="22-refactor-use-cases">2.2 Refactor Use Cases</h4>
<p><strong>For each use case:</strong></p>
<ol>
<li>Remove <code>createAsyncThunk</code> import</li>
<li>Change <code>execute</code> from thunk to async method</li>
<li>Remove Redux-specific parameters (<code>getState</code>, <code>rejectWithValue</code>)</li>
<li>Add required parameters to method signature</li>
<li>Return plain result type (not Redux action)</li>
</ol>
<p><strong>Example Refactor:</strong></p>
<p><strong>BEFORE:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveMetricLogsUseCase</span> {
  execute = createAsyncThunk&lt;<span class="hljs-title class_">SuccessMessage</span>, <span class="hljs-title class_">Params</span>, { <span class="hljs-attr">rejectValue</span>: <span class="hljs-built_in">string</span> }&gt;(
    <span class="hljs-string">&quot;metricLog/saveLogs&quot;</span>,
    <span class="hljs-title function_">async</span> ({ logDate, inserts, deletes }, { rejectWithValue }) =&gt; {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">saveMetricLogs</span>(logDate, inserts, deletes);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejectWithValue</span>(error.<span class="hljs-property">message</span>);
      }
    },
  );
}
</code></pre>
<p><strong>AFTER:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SaveMetricLogsParams</span> {
  <span class="hljs-attr">logDate</span>: <span class="hljs-title class_">Date</span>;
  <span class="hljs-attr">inserts</span>: { <span class="hljs-attr">metric_id</span>: <span class="hljs-title class_">MetricId</span>; <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> }[];
  <span class="hljs-attr">deletes</span>: <span class="hljs-title class_">MetricId</span>[];
}

<span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveMetricLogsUseCase</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@inject</span>(<span class="hljs-string">&quot;MetricLogRepository&quot;</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">MetricLogRepository</span>,
  </span>) {}

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">SaveMetricLogsParams</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">SuccessMessage</span>&gt; {
    <span class="hljs-keyword">const</span> { logDate, inserts, deletes } = params;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">saveMetricLogs</span>(logDate, inserts, deletes);
  }
}
</code></pre>
<p><strong>Estimated Time:</strong> 8-12 hours (24 use cases  20-30 min each)</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="19" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="23-update-redux-slices">2.3 Update Redux Slices</h4>
<p><strong>For each slice:</strong></p>
<ol>
<li>Remove <code>container.resolve()</code> from <code>extraReducers</code></li>
<li>Import thunks from new thunk files</li>
<li>Update case handlers to use new thunk names</li>
<li>Keep reducer logic unchanged</li>
</ol>
<p><strong>BEFORE:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-attr">extraReducers</span>: <span class="hljs-function">(<span class="hljs-params">builder</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> getLifeContextThunk = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>).<span class="hljs-property">execute</span>;
  builder.<span class="hljs-title function_">addCase</span>(getLifeContextThunk.<span class="hljs-property">pending</span>, <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
    <span class="hljs-comment">/*...*/</span>
  });
};
</code></pre>
<p><strong>AFTER:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-keyword">import</span> { fetchLifeContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../thunks/lifeContext.thunks&quot;</span>;

<span class="hljs-attr">extraReducers</span>: <span class="hljs-function">(<span class="hljs-params">builder</span>) =&gt;</span> {
  builder
    .<span class="hljs-title function_">addCase</span>(fetchLifeContext.<span class="hljs-property">pending</span>, <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
      <span class="hljs-comment">/*...*/</span>
    })
    .<span class="hljs-title function_">addCase</span>(fetchLifeContext.<span class="hljs-property">fulfilled</span>, <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
      <span class="hljs-comment">/*...*/</span>
    });
};
</code></pre>
<p><strong>Estimated Time:</strong> 3-4 hours (13 slices  15-20 min each)</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="20" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="24-update-viewmodels">2.4 Update ViewModels</h4>
<p><strong>For each ViewModel:</strong></p>
<ol>
<li>Update dispatch calls to use new thunk names</li>
<li>Update imports</li>
</ol>
<p><strong>BEFORE:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-keyword">const</span> getLifeContextUseCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>);
<span class="hljs-keyword">await</span> <span class="hljs-title function_">dispatch</span>(getLifeContextUseCase.<span class="hljs-title function_">execute</span>()).<span class="hljs-title function_">unwrap</span>();
</code></pre>
<p><strong>AFTER:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-keyword">import</span> { fetchLifeContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/presentation/state/thunks/lifeContext.thunks&quot;</span>;
<span class="hljs-keyword">await</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">fetchLifeContext</span>()).<span class="hljs-title function_">unwrap</span>();
</code></pre>
<p><strong>Estimated Time:</strong> 2-3 hours (~20 ViewModels  5-10 min each)</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="21" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="phase-3-optimization-week-4-%F0%9F%8E%AF">Phase 3: Optimization (Week 4) <img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/1f3af.svg" data-marp-twemoji=""/></h3>
<p><strong>Priority: MEDIUM | Effort: LOW</strong></p>
<h4 id="31-simplify-stateless-services">3.1 Simplify Stateless Services</h4>
<p><strong>Convert DI services to plain functions:</strong></p>
<p><strong>BEFORE:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateRangeService</span> {
  <span class="hljs-title function_">createDateRange</span>(<span class="hljs-attr">startDate</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">endDate</span>: <span class="hljs-title class_">Date</span>): <span class="hljs-title class_">DateRange</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateRange</span>(startDate, endDate);
  }
}
</code></pre>
<p><strong>AFTER:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createDateRange = (<span class="hljs-attr">startDate</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-attr">endDate</span>: <span class="hljs-title class_">Date</span>): <span class="hljs-function"><span class="hljs-params">DateRange</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateRange</span>(startDate, endDate);
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createDateRangeFromContextSequence = (
  <span class="hljs-attr">contextSequence</span>: <span class="hljs-title class_">LifeContextSequenceElement</span>[],
): <span class="hljs-function"><span class="hljs-params">DateRange</span> =&gt;</span> {
  <span class="hljs-comment">// ... implementation</span>
};
</code></pre>
<p><strong>Services to Convert:</strong></p>
<ul>
<li><code>DateRangeService</code>  functions</li>
<li><code>UserAuthService</code>  functions (already static methods)</li>
</ul>
<p><strong>Estimated Time:</strong> 2 hours</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="22" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="32-fix-infrastructure-violations">3.2 Fix Infrastructure Violations</h4>
<p><strong>Move hormone generators from screens to application:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-bash"><span class="hljs-comment"># From:</span>
src/screens/StatusTab/Today/Chart/Hormone/hormoneDataGenerator/

<span class="hljs-comment"># To:</span>
src/application/services/hormoneDataGenerator/
</code></pre>
<p><strong>Update DI Container:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/container.ts (moved outside layer structure)</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">HormoneDataGeneratorFactory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/application/services/hormoneDataGenerator/...&quot;</span>;
</code></pre>
<p><strong>Estimated Time:</strong> 1 hour</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="23" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="33-add-architecture-tests">3.3 Add Architecture Tests</h4>
<p><strong>Create automated boundary enforcement:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// __tests__/architecture.test.ts</span>
<span class="hljs-keyword">import</span> { checkDependencyRules } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;dependency-cruiser&quot;</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">&quot;Architecture Boundaries&quot;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">&quot;domain should not import from any other layer&quot;</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">checkDependencyRules</span>(<span class="hljs-string">&quot;src/domain&quot;</span>, {
      <span class="hljs-attr">forbidden</span>: [<span class="hljs-string">&quot;src/application&quot;</span>, <span class="hljs-string">&quot;src/infrastructure&quot;</span>, <span class="hljs-string">&quot;src/presentation&quot;</span>],
    });
    <span class="hljs-title function_">expect</span>(result.<span class="hljs-property">violations</span>).<span class="hljs-title function_">toEqual</span>([]);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">&quot;application should not import from presentation&quot;</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">checkDependencyRules</span>(<span class="hljs-string">&quot;src/application&quot;</span>, {
      <span class="hljs-attr">forbidden</span>: [<span class="hljs-string">&quot;src/presentation&quot;</span>],
    });
    <span class="hljs-title function_">expect</span>(result.<span class="hljs-property">violations</span>).<span class="hljs-title function_">toEqual</span>([]);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">&quot;application should not import from infrastructure&quot;</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">checkDependencyRules</span>(<span class="hljs-string">&quot;src/application&quot;</span>, {
      <span class="hljs-attr">forbidden</span>: [<span class="hljs-string">&quot;src/infrastructure&quot;</span>],
    });
    <span class="hljs-title function_">expect</span>(result.<span class="hljs-property">violations</span>).<span class="hljs-title function_">toEqual</span>([]);
  });
});
</code></pre>
<p><strong>Install dependency-cruiser:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-bash">npm install --save-dev dependency-cruiser
</code></pre>
<p><strong>Estimated Time:</strong> 2 hours</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="24" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="migration-timeline-summary">Migration Timeline Summary</h3>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Tasks</th>
<th>Estimated Time</th>
<th>Priority</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Phase 1</strong></td>
<td>Fix imports, Move StateManager</td>
<td>3-4 hours</td>
<td>HIGH</td>
</tr>
<tr>
<td><strong>Phase 2</strong></td>
<td>Decouple use cases, Create thunks</td>
<td>19-27 hours</td>
<td>HIGH</td>
</tr>
<tr>
<td><strong>Phase 3</strong></td>
<td>Optimize services, Add tests</td>
<td>5 hours</td>
<td>MEDIUM</td>
</tr>
<tr>
<td><strong>TOTAL</strong></td>
<td></td>
<td><strong>27-36 hours</strong></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Recommended Sprint Allocation:</strong></p>
<ul>
<li>Sprint 1: Phase 1 (1 day)</li>
<li>Sprint 2-3: Phase 2 (3-4 days)</li>
<li>Sprint 4: Phase 3 (1 day)</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="25" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="8-code-examples">8. Code Examples</h2>
<h3 id="81-beforeafter-use-case-decoupling">8.1 Before/After: Use Case Decoupling</h3>
<h4 id="example-1-getlifecontextusecase">Example 1: GetLifeContextUseCase</h4>
<p><strong>BEFORE (Coupled to Redux):</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/application/useCases/lifeContext/GetLifeContext.useCase.ts</span>
<span class="hljs-keyword">import</span> { injectable, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;tsyringe&quot;</span>;
<span class="hljs-keyword">import</span> { createAsyncThunk } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RootState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../StateManager/store&quot;</span>;

<span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetLifeContextUseCase</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@inject</span>(<span class="hljs-string">&quot;LifeContextRepository&quot;</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">LifeContextRepository</span>,
    <span class="hljs-meta">@inject</span>(<span class="hljs-string">&quot;LifeContextSequenceService&quot;</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">sequenceService</span>: <span class="hljs-title class_">LifeContextSequenceService</span>,
  </span>) {}

  execute = createAsyncThunk&lt;
    {
      <span class="hljs-attr">contexts</span>: <span class="hljs-title class_">LifeContext</span>[];
      <span class="hljs-attr">contextSequence</span>: <span class="hljs-title class_">LifeContextSequenceElement</span>[];
      <span class="hljs-attr">activePregnancy</span>: <span class="hljs-title class_">LifeContextId</span> | <span class="hljs-literal">undefined</span>;
      <span class="hljs-attr">activeMenstruation</span>: <span class="hljs-title class_">LifeContextId</span> | <span class="hljs-literal">undefined</span>;
    },
    <span class="hljs-built_in">void</span>,
    { <span class="hljs-attr">rejectValue</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">state</span>: <span class="hljs-title class_">RootState</span> }
  &gt;(<span class="hljs-string">&quot;lifeContext/getLifeContext&quot;</span>, <span class="hljs-title function_">async</span> (_, { getState, rejectWithValue }) =&gt; {
    <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">getState</span>();
    <span class="hljs-keyword">const</span> uid = <span class="hljs-title class_">UserAuthService</span>.<span class="hljs-title function_">getAuthenticatedUid</span>(state);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> contexts = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">getAll</span>(uid);
      <span class="hljs-keyword">const</span> activePregnancy = contexts.<span class="hljs-title function_">find</span>(<span class="hljs-comment">/*...*/</span>);
      <span class="hljs-keyword">const</span> activeMenstruation = contexts.<span class="hljs-title function_">find</span>(<span class="hljs-comment">/*...*/</span>);
      <span class="hljs-keyword">const</span> contextSequence = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sequenceService</span>.<span class="hljs-title function_">createSequence</span>(contexts);

      <span class="hljs-keyword">return</span> {
        contexts,
        contextSequence,
        <span class="hljs-attr">activePregnancy</span>: activePregnancy?.<span class="hljs-property">id</span>,
        <span class="hljs-attr">activeMenstruation</span>: activeMenstruation?.<span class="hljs-property">id</span>,
      };
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejectWithValue</span>(error.<span class="hljs-property">message</span>);
    }
  });
}
</code></pre>
<p><strong>AFTER (Framework-Agnostic):</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/application/useCases/lifeContext/GetLifeContext.useCase.ts</span>
<span class="hljs-keyword">import</span> { injectable, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;tsyringe&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GetLifeContextResult</span> {
  <span class="hljs-attr">contexts</span>: <span class="hljs-title class_">LifeContext</span>[];
  <span class="hljs-attr">contextSequence</span>: <span class="hljs-title class_">LifeContextSequenceElement</span>[];
  <span class="hljs-attr">activePregnancy</span>: <span class="hljs-title class_">LifeContextId</span> | <span class="hljs-literal">undefined</span>;
  <span class="hljs-attr">activeMenstruation</span>: <span class="hljs-title class_">LifeContextId</span> | <span class="hljs-literal">undefined</span>;
}

<span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetLifeContextUseCase</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@inject</span>(<span class="hljs-string">&quot;LifeContextRepository&quot;</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">LifeContextRepository</span>,
    <span class="hljs-meta">@inject</span>(<span class="hljs-string">&quot;LifeContextSequenceService&quot;</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">sequenceService</span>: <span class="hljs-title class_">LifeContextSequenceService</span>,
  </span>) {}

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-attr">uid</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">GetLifeContextResult</span>&gt; {
    <span class="hljs-keyword">const</span> contexts = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">getAll</span>(uid);

    <span class="hljs-keyword">const</span> activePregnancy = contexts.<span class="hljs-title function_">find</span>(
      <span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span>
        <span class="hljs-title function_">isPregnancy</span>(c.<span class="hljs-property">context</span>) &amp;&amp;
        c.<span class="hljs-property">context</span>.<span class="hljs-property">isActive</span> &amp;&amp;
        !c.<span class="hljs-property">context</span>.<span class="hljs-property">metadata</span>.<span class="hljs-property">abortion</span>,
    )?.<span class="hljs-property">context</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Pregnancy</span> | <span class="hljs-literal">undefined</span>;

    <span class="hljs-keyword">const</span> activeMenstruation = contexts.<span class="hljs-title function_">find</span>(
      <span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> <span class="hljs-title function_">isMenstruation</span>(c.<span class="hljs-property">context</span>) &amp;&amp; c.<span class="hljs-property">context</span>.<span class="hljs-property">isActive</span>,
    )?.<span class="hljs-property">context</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Menstruation</span> | <span class="hljs-literal">undefined</span>;

    <span class="hljs-keyword">const</span> contextSequence = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sequenceService</span>.<span class="hljs-title function_">createSequence</span>(contexts);

    <span class="hljs-keyword">return</span> {
      contexts,
      contextSequence,
      <span class="hljs-attr">activePregnancy</span>: activePregnancy?.<span class="hljs-property">id</span>,
      <span class="hljs-attr">activeMenstruation</span>: activeMenstruation?.<span class="hljs-property">id</span>,
    };
  }
}
</code></pre>
<p><strong>NEW: Redux Thunk (Presentation Layer):</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/presentation/state/thunks/lifeContext.thunks.ts</span>
<span class="hljs-keyword">import</span> { createAsyncThunk } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;
<span class="hljs-keyword">import</span> { container } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;tsyringe&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GetLifeContextUseCase</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/application/useCases/lifeContext/GetLifeContext.useCase&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">GetLifeContextResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/application/useCases/lifeContext/GetLifeContext.useCase&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RootState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../store&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchLifeContext = createAsyncThunk&lt;
  <span class="hljs-title class_">GetLifeContextResult</span>,
  <span class="hljs-built_in">void</span>,
  { <span class="hljs-attr">rejectValue</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">state</span>: <span class="hljs-title class_">RootState</span> }
&gt;(<span class="hljs-string">&quot;lifeContext/fetch&quot;</span>, <span class="hljs-title function_">async</span> (_, { getState, rejectWithValue }) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">getState</span>();
    <span class="hljs-keyword">const</span> uid = (state.<span class="hljs-property">user</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">uid</span>;

    <span class="hljs-keyword">if</span> (!uid) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejectWithValue</span>(<span class="hljs-string">&quot;User not authenticated&quot;</span>);
    }

    <span class="hljs-keyword">const</span> useCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> useCase.<span class="hljs-title function_">execute</span>(uid);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejectWithValue</span>(
      error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">&quot;Failed to fetch life contexts&quot;</span>,
    );
  }
});
</code></pre>
<p><strong>NEW: Redux Slice (Updated):</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/presentation/state/slices/lifeContext/lifeContext.slice.ts</span>
<span class="hljs-keyword">import</span> { createSlice } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;
<span class="hljs-keyword">import</span> { fetchLifeContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../thunks/lifeContext.thunks&quot;</span>;

<span class="hljs-keyword">const</span> lifeContextSlice = <span class="hljs-title function_">createSlice</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;lifeContext&quot;</span>,
  initialState,
  <span class="hljs-attr">reducers</span>: {},
  <span class="hljs-attr">extraReducers</span>: <span class="hljs-function">(<span class="hljs-params">builder</span>) =&gt;</span> {
    builder
      .<span class="hljs-title function_">addCase</span>(fetchLifeContext.<span class="hljs-property">pending</span>, <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
        state.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>;
        state.<span class="hljs-property">error</span> = <span class="hljs-literal">null</span>;
      })
      .<span class="hljs-title function_">addCase</span>(fetchLifeContext.<span class="hljs-property">fulfilled</span>, <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
        state.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
        state.<span class="hljs-property">contexts</span> = action.<span class="hljs-property">payload</span>.<span class="hljs-property">contexts</span>.<span class="hljs-title function_">reduce</span>(
          <span class="hljs-function">(<span class="hljs-params">acc, context</span>) =&gt;</span> {
            acc[context.<span class="hljs-property">context</span>.<span class="hljs-property">id</span>] = context;
            <span class="hljs-keyword">return</span> acc;
          },
          {} <span class="hljs-keyword">as</span> { [<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-title class_">LifeContext</span> },
        );
        state.<span class="hljs-property">contextSequence</span> = action.<span class="hljs-property">payload</span>.<span class="hljs-property">contextSequence</span>;
        state.<span class="hljs-property">currentPregnancy</span> = action.<span class="hljs-property">payload</span>.<span class="hljs-property">activePregnancy</span> ?? <span class="hljs-literal">null</span>;
        state.<span class="hljs-property">currentMenstruation</span> = action.<span class="hljs-property">payload</span>.<span class="hljs-property">activeMenstruation</span> ?? <span class="hljs-literal">null</span>;
      })
      .<span class="hljs-title function_">addCase</span>(fetchLifeContext.<span class="hljs-property">rejected</span>, <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> {
        state.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
        state.<span class="hljs-property">error</span> = action.<span class="hljs-property">payload</span> || <span class="hljs-string">&quot;Failed to fetch life contexts&quot;</span>;
      });
  },
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> lifeContextSlice.<span class="hljs-property">reducer</span>;
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="26" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="example-2-savemetriclogsusecase">Example 2: SaveMetricLogsUseCase</h4>
<p><strong>BEFORE:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/application/useCases/metricLog/SaveMetricLogs.useCase.ts</span>
<span class="hljs-keyword">import</span> { injectable, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;tsyringe&quot;</span>;
<span class="hljs-keyword">import</span> { createAsyncThunk } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;

<span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveMetricLogsUseCase</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@inject</span>(<span class="hljs-string">&quot;MetricLogRepository&quot;</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">MetricLogRepository</span>,
  </span>) {}

  execute = createAsyncThunk&lt;
    <span class="hljs-title class_">SuccessMessage</span>,
    { <span class="hljs-attr">logDate</span>: <span class="hljs-title class_">Date</span>; <span class="hljs-attr">inserts</span>: <span class="hljs-title class_">Insert</span>[]; <span class="hljs-attr">deletes</span>: <span class="hljs-title class_">MetricId</span>[] },
    { <span class="hljs-attr">rejectValue</span>: <span class="hljs-built_in">string</span> }
  &gt;(
    <span class="hljs-string">&quot;metricLog/saveLogs&quot;</span>,
    <span class="hljs-title function_">async</span> ({ logDate, inserts, deletes }, { rejectWithValue }) =&gt; {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">saveMetricLogs</span>(logDate, inserts, deletes);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejectWithValue</span>(error.<span class="hljs-property">message</span>);
      }
    },
  );
}
</code></pre>
<p><strong>AFTER:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/application/useCases/metricLog/SaveMetricLogs.useCase.ts</span>
<span class="hljs-keyword">import</span> { injectable, inject } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;tsyringe&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SaveMetricLogsParams</span> {
  <span class="hljs-attr">logDate</span>: <span class="hljs-title class_">Date</span>;
  <span class="hljs-attr">inserts</span>: { <span class="hljs-attr">metric_id</span>: <span class="hljs-title class_">MetricId</span>; <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> }[];
  <span class="hljs-attr">deletes</span>: <span class="hljs-title class_">MetricId</span>[];
}

<span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveMetricLogsUseCase</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@inject</span>(<span class="hljs-string">&quot;MetricLogRepository&quot;</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">MetricLogRepository</span>,
  </span>) {}

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">SaveMetricLogsParams</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">SuccessMessage</span>&gt; {
    <span class="hljs-keyword">const</span> { logDate, inserts, deletes } = params;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">saveMetricLogs</span>(logDate, inserts, deletes);
  }
}
</code></pre>
<p><strong>NEW: Thunk:</strong></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// src/presentation/state/thunks/metricLog.thunks.ts</span>
<span class="hljs-keyword">import</span> { createAsyncThunk } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@reduxjs/toolkit&quot;</span>;
<span class="hljs-keyword">import</span> { container } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;tsyringe&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SaveMetricLogsUseCase</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/application/useCases/metricLog/SaveMetricLogs.useCase&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">SaveMetricLogsParams</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/application/useCases/metricLog/SaveMetricLogs.useCase&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> saveMetricLogs = createAsyncThunk&lt;
  <span class="hljs-title class_">SuccessMessage</span>,
  <span class="hljs-title class_">SaveMetricLogsParams</span>,
  { <span class="hljs-attr">rejectValue</span>: <span class="hljs-built_in">string</span> }
&gt;(<span class="hljs-string">&quot;metricLog/save&quot;</span>, <span class="hljs-title function_">async</span> (params, { rejectWithValue }) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> useCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">SaveMetricLogsUseCase</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> useCase.<span class="hljs-title function_">execute</span>(params);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejectWithValue</span>(
      error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">&quot;Failed to save metric logs&quot;</span>,
    );
  }
});
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="27" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="82-testing-improvements">8.2 Testing Improvements</h3>
<h4 id="before-requires-redux-mocking">Before (Requires Redux Mocking)</h4>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// BEFORE: Hard to test</span>
<span class="hljs-title function_">describe</span>(<span class="hljs-string">&quot;GetLifeContextUseCase&quot;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">&quot;should fetch contexts&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; {
    <span class="hljs-comment">// Must mock Redux store, dispatch, getState, etc.</span>
    <span class="hljs-keyword">const</span> mockDispatch = jest.<span class="hljs-title function_">fn</span>();
    <span class="hljs-keyword">const</span> mockGetState = jest.<span class="hljs-title function_">fn</span>(<span class="hljs-function">() =&gt;</span> ({ <span class="hljs-attr">user</span>: { <span class="hljs-attr">uid</span>: <span class="hljs-string">&quot;test-uid&quot;</span> } }));

    <span class="hljs-keyword">const</span> thunk = useCase.<span class="hljs-title function_">execute</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">thunk</span>(mockDispatch, mockGetState, <span class="hljs-literal">undefined</span>);

    <span class="hljs-title function_">expect</span>(mockDispatch).<span class="hljs-title function_">toHaveBeenCalled</span>();
    <span class="hljs-comment">// Complex assertions...</span>
  });
});
</code></pre>
<h4 id="after-pure-function-testing">After (Pure Function Testing)</h4>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// AFTER: Clean, simple tests</span>
<span class="hljs-title function_">describe</span>(<span class="hljs-string">&quot;GetLifeContextUseCase&quot;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">useCase</span>: <span class="hljs-title class_">GetLifeContextUseCase</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">mockRepository</span>: jest.<span class="hljs-property">Mocked</span>&lt;<span class="hljs-title class_">LifeContextRepository</span>&gt;;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">mockSequenceService</span>: jest.<span class="hljs-property">Mocked</span>&lt;<span class="hljs-title class_">LifeContextSequenceService</span>&gt;;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {
    mockRepository = {
      <span class="hljs-attr">getAll</span>: jest.<span class="hljs-title function_">fn</span>(),
    } <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;

    mockSequenceService = {
      <span class="hljs-attr">createSequence</span>: jest.<span class="hljs-title function_">fn</span>(),
    } <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;

    useCase = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GetLifeContextUseCase</span>(mockRepository, mockSequenceService);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">&quot;should fetch and return life contexts&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; {
    <span class="hljs-comment">// Arrange</span>
    <span class="hljs-keyword">const</span> mockContexts = [mockPregnancy, mockMenstruation];
    mockRepository.<span class="hljs-property">getAll</span>.<span class="hljs-title function_">mockResolvedValue</span>(mockContexts);
    mockSequenceService.<span class="hljs-property">createSequence</span>.<span class="hljs-title function_">mockReturnValue</span>(mockSequence);

    <span class="hljs-comment">// Act</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> useCase.<span class="hljs-title function_">execute</span>(<span class="hljs-string">&quot;test-uid&quot;</span>);

    <span class="hljs-comment">// Assert</span>
    <span class="hljs-title function_">expect</span>(result.<span class="hljs-property">contexts</span>).<span class="hljs-title function_">toEqual</span>(mockContexts);
    <span class="hljs-title function_">expect</span>(result.<span class="hljs-property">activePregnancy</span>).<span class="hljs-title function_">toBe</span>(mockPregnancy.<span class="hljs-property">id</span>);
    <span class="hljs-title function_">expect</span>(mockRepository.<span class="hljs-property">getAll</span>).<span class="hljs-title function_">toHaveBeenCalledWith</span>(<span class="hljs-string">&quot;test-uid&quot;</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">&quot;should handle errors gracefully&quot;</span>, <span class="hljs-title function_">async</span> () =&gt; {
    <span class="hljs-comment">// Arrange</span>
    mockRepository.<span class="hljs-property">getAll</span>.<span class="hljs-title function_">mockRejectedValue</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Network error&quot;</span>));

    <span class="hljs-comment">// Act &amp; Assert</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(useCase.<span class="hljs-title function_">execute</span>(<span class="hljs-string">&quot;test-uid&quot;</span>)).<span class="hljs-property">rejects</span>.<span class="hljs-title function_">toThrow</span>(<span class="hljs-string">&quot;Network error&quot;</span>);
  });
});
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="28" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="83-reusability-examples">8.3 Reusability Examples</h3>
<p>With decoupled use cases, you can now:</p>
<h4 id="cli-script">CLI Script</h4>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// scripts/export-life-contexts.ts</span>
<span class="hljs-keyword">import</span> { container } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;tsyringe&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GetLifeContextUseCase</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/application/useCases/lifeContext/GetLifeContext.useCase&quot;</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">exportLifeContexts</span>(<span class="hljs-params"><span class="hljs-attr">uid</span>: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> useCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>);
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> useCase.<span class="hljs-title function_">execute</span>(uid);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Exporting <span class="hljs-subst">${result.contexts.length}</span> contexts...`</span>);
  <span class="hljs-comment">// Write to file, send to API, etc.</span>
}

<span class="hljs-title function_">exportLifeContexts</span>(process.<span class="hljs-property">argv</span>[<span class="hljs-number">2</span>]);
</code></pre>
<h4 id="background-worker">Background Worker</h4>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// workers/sync-contexts.worker.ts</span>
<span class="hljs-keyword">import</span> { container } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;tsyringe&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GetLifeContextUseCase</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/application/useCases/lifeContext/GetLifeContext.useCase&quot;</span>;

self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-title function_">async</span> (event) =&gt; {
  <span class="hljs-keyword">const</span> { uid } = event.<span class="hljs-property">data</span>;

  <span class="hljs-keyword">const</span> useCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>);
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> useCase.<span class="hljs-title function_">execute</span>(uid);

  <span class="hljs-comment">// Sync to external service</span>
  self.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">count</span>: result.<span class="hljs-property">contexts</span>.<span class="hljs-property">length</span> });
});
</code></pre>
<h4 id="different-state-management-zustand">Different State Management (Zustand)</h4>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-typescript"><span class="hljs-comment">// store/lifeContextStore.ts (Zustand example)</span>
<span class="hljs-keyword">import</span> create <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zustand&quot;</span>;
<span class="hljs-keyword">import</span> { container } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;tsyringe&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GetLifeContextUseCase</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/application/useCases/lifeContext/GetLifeContext.useCase&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useLifeContextStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">contexts</span>: [],
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,

  <span class="hljs-attr">fetchContexts</span>: <span class="hljs-title function_">async</span> (<span class="hljs-attr">uid</span>: <span class="hljs-built_in">string</span>) =&gt; {
    <span class="hljs-title function_">set</span>({ <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span> });

    <span class="hljs-keyword">const</span> useCase = container.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">GetLifeContextUseCase</span>);
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> useCase.<span class="hljs-title function_">execute</span>(uid);

    <span class="hljs-title function_">set</span>({ <span class="hljs-attr">contexts</span>: result.<span class="hljs-property">contexts</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> });
  },
}));
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="29" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="9-decision-framework">9. Decision Framework</h2>
<h3 id="when-to-use-each-pattern">When to Use Each Pattern</h3>
<h4 id="use-di--use-cases-when">Use DI + Use Cases When</h4>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Complex business logic with multiple dependencies<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Need to swap implementations (repositories)<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Need testability with mocks<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Logic will be reused across different contexts</p>
<p><strong>Example:</strong> <code>GetLifeContextUseCase</code> - orchestrates multiple services, needs testing</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="30" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="use-plain-functions-when">Use Plain Functions When</h4>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Stateless transformations<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> No dependencies<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Pure functions<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Simple utilities</p>
<p><strong>Example:</strong> Date formatting, validation helpers</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="31" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="use-thunks-presentation-when">Use Thunks (Presentation) When</h4>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Connecting use cases to Redux<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Accessing Redux state<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Dispatching multiple actions<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> UI-specific orchestration</p>
<p><strong>Example:</strong> Fetching data and updating loading states</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="32" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="keep-in-application-layer">Keep in Application Layer</h4>
<ul>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Use cases (business workflows)</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Application services (orchestration logic)</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Repository interfaces</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Domain-specific types</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> NOT Redux, NOT React hooks, NOT UI components</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="33" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h4 id="keep-in-presentation-layer">Keep in Presentation Layer</h4>
<ul>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Redux (store, slices, thunks, listeners)</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> React hooks (ViewModels)</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> UI components</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> Screen-specific logic</li>
<li><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/274c.svg" data-marp-twemoji=""/> NOT business rules, NOT data access</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="34" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h3 id="architecture-checklist">Architecture Checklist</h3>
<p>Use this checklist when adding new features:</p>
<p><strong>For New Business Logic:</strong></p>
<ul>
<li>[ ] Is this a business rule?  Add to Domain</li>
<li>[ ] Does it orchestrate multiple operations?  Create Use Case</li>
<li>[ ] Does it need external data?  Define Repository interface</li>
</ul>
<p><strong>For New UI Features:</strong></p>
<ul>
<li>[ ] Does it manage state?  Create Redux slice</li>
<li>[ ] Does it call use cases?  Create thunk</li>
<li>[ ] Does it format data for display?  Create ViewModel hook</li>
<li>[ ] Is it visual?  Create Component</li>
</ul>
<p><strong>For New External Services:</strong></p>
<ul>
<li>[ ] Implement Repository interface in Infrastructure</li>
<li>[ ] Register in DI container</li>
<li>[ ] Add serializers/mappers as needed</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="35" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="10-conclusion">10. Conclusion</h2>
<h3 id="summary-of-recommendations">Summary of Recommendations</h3>
<table>
<thead>
<tr>
<th>Recommendation</th>
<th>Priority</th>
<th>Effort</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Keep 4-layer architecture</strong></td>
<td>N/A</td>
<td>None</td>
<td>Maintains clarity</td>
</tr>
<tr>
<td><strong>Decouple use cases from Redux</strong></td>
<td>HIGH</td>
<td>Medium</td>
<td>Framework independence</td>
</tr>
<tr>
<td><strong>Move StateManager to Presentation</strong></td>
<td>HIGH</td>
<td>Low</td>
<td>Correct layer placement</td>
</tr>
<tr>
<td><strong>Fix cross-layer type imports</strong></td>
<td>HIGH</td>
<td>Low</td>
<td>Clean dependencies</td>
</tr>
<tr>
<td><strong>Create thunk files</strong></td>
<td>HIGH</td>
<td>Medium</td>
<td>Separation of concerns</td>
</tr>
<tr>
<td><strong>Simplify stateless services</strong></td>
<td>MEDIUM</td>
<td>Low</td>
<td>Reduced complexity</td>
</tr>
<tr>
<td><strong>Add architecture tests</strong></td>
<td>MEDIUM</td>
<td>Low</td>
<td>Prevent regressions</td>
</tr>
</tbody>
</table>
<h3 id="key-principles-moving-forward">Key Principles Moving Forward</h3>
<ol>
<li>
<p><strong>Application Layer = Framework-Agnostic</strong></p>
<ul>
<li>No Redux imports</li>
<li>No React imports</li>
<li>Pure TypeScript business logic</li>
</ul>
</li>
<li>
<p><strong>Presentation Layer = UI &amp; State</strong></p>
<ul>
<li>Redux thunks live here</li>
<li>React hooks live here</li>
<li>ViewModels live here</li>
</ul>
</li>
<li>
<p><strong>Infrastructure Layer = External World</strong></p>
<ul>
<li>Database implementations</li>
<li>API clients</li>
<li>Third-party services</li>
</ul>
</li>
<li>
<p><strong>Domain Layer = Pure Business Rules</strong></p>
<ul>
<li>Zero dependencies</li>
<li>Framework-agnostic</li>
<li>Highly testable</li>
</ul>
</li>
</ol>
<h3 id="expected-outcomes">Expected Outcomes</h3>
<p>After migration:</p>
<p><img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Use cases are testable</strong> without Redux<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Use cases are reusable</strong> in scripts, workers, CLI<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Clear layer boundaries</strong> with no violations<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Easier to swap</strong> state management libraries<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Better team understanding</strong> of architecture<br />
<img class="emoji" draggable="false" alt="" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@16.0.1/assets/svg/2705.svg" data-marp-twemoji=""/> <strong>Faster development</strong> with clear patterns</p>
<h3 id="next-steps">Next Steps</h3>
<ol>
<li><strong>Review this report</strong> with the team</li>
<li><strong>Approve migration plan</strong> and timeline</li>
<li><strong>Start with Phase 1</strong> (quick wins)</li>
<li><strong>Create tracking issues</strong> for each phase</li>
<li><strong>Document patterns</strong> as you go</li>
<li><strong>Update team guidelines</strong> with new patterns</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="36" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="appendix-a-complete-use-case-list">Appendix A: Complete Use Case List</h2>
<p>All 24 use cases requiring refactoring:</p>
<h3 id="lifecontext-7">LifeContext (7)</h3>
<ol>
<li><code>GetLifeContextUseCase</code></li>
<li><code>InitiateMenstruationLifeContextUseCase</code></li>
<li><code>RestartMenstruationLifeContextUseCase</code></li>
<li><code>CalculateMenstrualCyclesUseCase</code></li>
<li><code>UpdateMenstrualPhaseLengthsDataUseCase</code></li>
<li><code>RecomputeAfterLifeContextChangeUseCase</code></li>
<li><code>GetStatusModeUseCase</code></li>
</ol>
<h3 id="metriclog-4">MetricLog (4)</h3>
<ol start="8">
<li><code>SaveMetricLogsUseCase</code></li>
<li><code>ListMetricLogsUseCase</code></li>
<li><code>ListMetricCategoriesUseCase</code></li>
<li><code>ListBleedingLogsUseCase</code></li>
</ol>
<h3 id="myhealth-5">MyHealth (5)</h3>
<ol start="12">
<li><code>SetSicknessAndAilmentsUseCase</code></li>
<li><code>SetSexualActivityUseCase</code></li>
<li><code>SetPhysicalActivityUseCase</code></li>
<li><code>SetDrugUseUseCase</code></li>
<li><code>SetBirthControlUseCase</code></li>
</ol>
<h3 id="other-8">Other (8)</h3>
<ol start="17">
<li><code>SetActivityFrequencyUseCase</code></li>
<li><code>ShouldShowCycleTrackingPromptUseCase</code></li>
<li><code>ClosePostPartumsUseCase</code></li>
<li><code>SaveMenstruationOnboardingDataUseCase</code></li>
<li><code>GetInsightUseCase</code></li>
<li><code>GetCarefeedItemsUseCase</code></li>
<li><code>GetCarefeedFiltersUseCase</code></li>
<li><code>SetUserInterestsUseCase</code></li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="37" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="appendix-b-file-move-checklist">Appendix B: File Move Checklist</h2>
<h3 id="statemanager-migration">StateManager Migration</h3>
<p><strong>From <code>src/application/StateManager/</code> to <code>src/presentation/state/</code>:</strong></p>
<ul>
<li>[ ] <code>store.ts</code></li>
<li>[ ] <code>slices/lifeContext/lifeContextSlice.ts</code></li>
<li>[ ] <code>slices/lifeContext/statusModeSlice.ts</code></li>
<li>[ ] <code>slices/lifeContext/lifeContextTriggers.ts</code></li>
<li>[ ] <code>slices/metricLog/metricLogSlice.ts</code></li>
<li>[ ] <code>slices/insight/insightSlice.ts</code></li>
<li>[ ] <code>slices/user/health.slice.ts</code></li>
<li>[ ] <code>slices/onboarding/onboarding.slice.ts</code></li>
<li>[ ] <code>slices/sanity/carefeedQuerySlice.ts</code></li>
<li>[ ] <code>slices/app/appSlice.ts</code></li>
<li>[ ] <code>listeners/menstrualCycle.listeners.ts</code></li>
<li>[ ] <code>listeners/insight.listeners.ts</code></li>
<li>[ ] <code>listeners/recomputation.listeners.ts</code></li>
<li>[ ] <code>listeners/onboarding.listners.ts</code></li>
</ul>
<p><strong>Update imports in ~50 files</strong> that reference <code>@/application/StateManager</code></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="38" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<h2 id="appendix-c-resources">Appendix C: Resources</h2>
<h3 id="recommended-reading">Recommended Reading</h3>
<ul>
<li><strong>Clean Architecture</strong> by Robert C. Martin - Chapters 17-22</li>
<li><strong>The Pragmatic Programmer</strong> (2nd Ed.) - Chapter on &quot;Decoupling&quot;</li>
<li><a href="https://redux-toolkit.js.org/usage/usage-guide">Redux Toolkit Best Practices</a></li>
<li><a href="https://alistair.cockburn.us/hexagonal-architecture/">Hexagonal Architecture</a></li>
</ul>
<h3 id="tools">Tools</h3>
<ul>
<li><strong>dependency-cruiser</strong> - Enforce architecture boundaries</li>
<li><strong>ts-morph</strong> - Automated refactoring scripts</li>
<li><strong>madge</strong> - Visualize dependency graphs</li>
</ul>
<h3 id="team-training">Team Training</h3>
<p>Consider scheduling:</p>
<ul>
<li>1-hour workshop on &quot;Clean Architecture Principles&quot;</li>
<li>30-min demo of &quot;Decoupled Use Case Pattern&quot;</li>
<li>Code review session for first refactored use case</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="39" data-theme="default" data-style="section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
" lang="C" style="--theme:default;--style:section {
  overflow: auto;
  font-size: 0.9rem;
}

section::before {
  display: none;
}
;">
<p><strong>Report End</strong></p>
<p><em>For questions or clarifications, please contact the architecture team.</em></p>
</section>
<script>!function(){"use strict";const t={h1:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"1"},style:"display: block; font-size: 2em; margin-block-start: 0.67em; margin-block-end: 0.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h2:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"2"},style:"display: block; font-size: 1.5em; margin-block-start: 0.83em; margin-block-end: 0.83em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h3:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"3"},style:"display: block; font-size: 1.17em; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h4:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"4"},style:"display: block; margin-block-start: 1.33em; margin-block-end: 1.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h5:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"5"},style:"display: block; font-size: 0.83em; margin-block-start: 1.67em; margin-block-end: 1.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h6:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"6"},style:"display: block; font-size: 0.67em; margin-block-start: 2.33em; margin-block-end: 2.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},span:{proto:()=>HTMLSpanElement},pre:{proto:()=>HTMLElement,style:"display: block; font-family: monospace; white-space: pre; margin: 1em 0; --marp-auto-scaling-white-space: pre;"}},e="data-marp-auto-scaling-wrapper",i="data-marp-auto-scaling-svg",n="data-marp-auto-scaling-container";class s extends HTMLElement{container;containerSize;containerObserver;svg;svgComputedStyle;svgPreserveAspectRatio="xMinYMid meet";wrapper;wrapperSize;wrapperObserver;constructor(){super();const t=t=>([e])=>{const{width:i,height:n}=e.contentRect;this[t]={width:i,height:n},this.updateSVGRect()};this.attachShadow({mode:"open"}),this.containerObserver=new ResizeObserver(t("containerSize")),this.wrapperObserver=new ResizeObserver((...e)=>{t("wrapperSize")(...e),this.flushSvgDisplay()})}static get observedAttributes(){return["data-downscale-only"]}connectedCallback(){this.shadowRoot.innerHTML=`\n<style>\n  svg[${i}] { display: block; width: 100%; height: auto; vertical-align: top; }\n  span[${n}] { display: table; white-space: var(--marp-auto-scaling-white-space, nowrap); width: max-content; }\n</style>\n<div ${e}>\n  <svg part="svg" ${i}>\n    <foreignObject><span ${n}><slot></slot></span></foreignObject>\n  </svg>\n</div>\n    `.split(/\n\s*/).join(""),this.wrapper=this.shadowRoot.querySelector(`div[${e}]`)??void 0;const t=this.svg;this.svg=this.wrapper?.querySelector(`svg[${i}]`)??void 0,this.svg!==t&&(this.svgComputedStyle=this.svg?window.getComputedStyle(this.svg):void 0),this.container=this.svg?.querySelector(`span[${n}]`)??void 0,this.observe()}disconnectedCallback(){this.svg=void 0,this.svgComputedStyle=void 0,this.wrapper=void 0,this.container=void 0,this.observe()}attributeChangedCallback(){this.observe()}flushSvgDisplay(){const{svg:t}=this;t&&(t.style.display="inline",requestAnimationFrame(()=>{t.style.display=""}))}observe(){this.containerObserver.disconnect(),this.wrapperObserver.disconnect(),this.wrapper&&this.wrapperObserver.observe(this.wrapper),this.container&&this.containerObserver.observe(this.container),this.svgComputedStyle&&this.observeSVGStyle(this.svgComputedStyle)}observeSVGStyle(t){const e=()=>{const i=(()=>{const e=t.getPropertyValue("--preserve-aspect-ratio");if(e)return e.trim();return`x${(({textAlign:t,direction:e})=>{if(t.endsWith("left"))return"Min";if(t.endsWith("right"))return"Max";if("start"===t||"end"===t){let i="rtl"===e;return"end"===t&&(i=!i),i?"Max":"Min"}return"Mid"})(t)}YMid meet`})();i!==this.svgPreserveAspectRatio&&(this.svgPreserveAspectRatio=i,this.updateSVGRect()),t===this.svgComputedStyle&&requestAnimationFrame(e)};e()}updateSVGRect(){let t=Math.ceil(this.containerSize?.width??0);const e=Math.ceil(this.containerSize?.height??0);void 0!==this.dataset.downscaleOnly&&(t=Math.max(t,this.wrapperSize?.width??0));const i=this.svg?.querySelector(":scope > foreignObject");if(i?.setAttribute("width",`${t}`),i?.setAttribute("height",`${e}`),this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${t} ${e}`),this.svg.setAttribute("preserveAspectRatio",this.svgPreserveAspectRatio),this.svg.style.height=t<=0||e<=0?"0":""),this.container){const t=this.svgPreserveAspectRatio.toLowerCase();this.container.style.marginLeft=t.startsWith("xmid")||t.startsWith("xmax")?"auto":"0",this.container.style.marginRight=t.startsWith("xmi")?"auto":"0"}}}const r=(t,{attrs:e={},style:i})=>class extends t{constructor(...t){super(...t);for(const[t,i]of Object.entries(e))this.hasAttribute(t)||this.setAttribute(t,i);this._shadow()}static get observedAttributes(){return["data-auto-scaling"]}connectedCallback(){this._update()}attributeChangedCallback(){this._update()}_shadow(){if(!this.shadowRoot)try{this.attachShadow({mode:"open"})}catch(t){if(!(t instanceof Error&&"NotSupportedError"===t.name))throw t}return this.shadowRoot}_update(){const t=this._shadow();if(t){const e=i?`<style>:host { ${i} }</style>`:"";let n="<slot></slot>";const{autoScaling:s}=this.dataset;if(void 0!==s){n=`<marp-auto-scaling exportparts="svg:auto-scaling" ${"downscale-only"===s?"data-downscale-only":""}>${n}</marp-auto-scaling>`}t.innerHTML=e+n}}};let o;const a=Symbol(),l=()=>o??(o=!!document.createElement("div",{is:"marp-auto-scaling"}).outerHTML.startsWith("<div is"),o);let c;const d="marpitSVGPolyfill:setZoomFactor,",h=Symbol(),g=Symbol();const p=()=>{const t="Apple Computer, Inc."===navigator.vendor,e=t?[v]:[],i={then:e=>(t?(async()=>{if(void 0===c){const t=document.createElement("canvas");t.width=10,t.height=10;const e=t.getContext("2d"),i=new Image(10,10),n=new Promise(t=>{i.addEventListener("load",()=>t())});i.crossOrigin="anonymous",i.src="data:image/svg+xml;charset=utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2210%22%20height%3D%2210%22%20viewBox%3D%220%200%201%201%22%3E%3CforeignObject%20width%3D%221%22%20height%3D%221%22%20requiredExtensions%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%3E%3Cdiv%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%22%20style%3D%22width%3A%201px%3B%20height%3A%201px%3B%20background%3A%20red%3B%20position%3A%20relative%22%3E%3C%2Fdiv%3E%3C%2FforeignObject%3E%3C%2Fsvg%3E",await n,e.drawImage(i,0,0),c=e.getImageData(5,5,1,1).data[3]<128}return c})().then(t=>{null==e||e(t?[v]:[])}):null==e||e([]),i)};return Object.assign(e,i)};let m,u;function v(t){const e="object"==typeof t&&t.target||document,i="object"==typeof t?t.zoom:t;window[g]||(Object.defineProperty(window,g,{configurable:!0,value:!0}),document.body.style.zoom=1.0001,document.body.offsetHeight,document.body.style.zoom=1,window.addEventListener("message",({data:t,origin:e})=>{if(e===window.origin)try{if(t&&"string"==typeof t&&t.startsWith(d)){const[,e]=t.split(","),i=Number.parseFloat(e);Number.isNaN(i)||(u=i)}}catch(t){console.error(t)}}));let n=!1;Array.from(e.querySelectorAll("svg[data-marpit-svg]"),t=>{var e,s,r,o;t.style.transform||(t.style.transform="translateZ(0)");const a=i||u||t.currentScale||1;m!==a&&(m=a,n=a);const l=t.getBoundingClientRect(),{length:c}=t.children;for(let i=0;i<c;i+=1){const n=t.children[i];if(n.getScreenCTM){const t=n.getScreenCTM();if(t){const i=null!==(s=null===(e=n.x)||void 0===e?void 0:e.baseVal.value)&&void 0!==s?s:0,c=null!==(o=null===(r=n.y)||void 0===r?void 0:r.baseVal.value)&&void 0!==o?o:0,d=n.children.length;for(let e=0;e<d;e+=1){const s=n.children[e];if("SECTION"===s.tagName){const{style:e}=s;e.transformOrigin||(e.transformOrigin=`${-i}px ${-c}px`),e.transform=`scale(${a}) matrix(${t.a}, ${t.b}, ${t.c}, ${t.d}, ${t.e-l.left}, ${t.f-l.top}) translateZ(0.0001px)`;break}}}}}}),!1!==n&&Array.from(e.querySelectorAll("iframe"),({contentWindow:t})=>{null==t||t.postMessage(`${d}${n}`,"null"===window.origin?"*":window.origin)})}function w({once:t=!1,target:e=document}={}){const i=function(t=document){if(t[h])return t[h];let e=!0;const i=()=>{e=!1,delete t[h]};Object.defineProperty(t,h,{configurable:!0,value:i});let n=[],s=!1;(async()=>{try{n=await p()}finally{s=!0}})();const r=()=>{for(const e of n)e({target:t});s&&0===n.length||e&&window.requestAnimationFrame(r)};return r(),i}(e);return t?(i(),()=>{}):i}m=1,u=void 0;const b=Symbol(),y=(e=document)=>{if("undefined"==typeof window)throw new Error("Marp Core's browser script is valid only in browser context.");if(((e=document)=>{const i=window[a];i||customElements.define("marp-auto-scaling",s);for(const n of Object.keys(t)){const s=`marp-${n}`,o=t[n].proto();l()&&o!==HTMLElement?i||customElements.define(s,r(o,{style:t[n].style}),{extends:n}):(i||customElements.define(s,r(HTMLElement,t[n])),e.querySelectorAll(`${n}[is="${s}"]`).forEach(t=>{t.outerHTML=t.outerHTML.replace(new RegExp(`^<${n}`,"i"),`<${s}`).replace(new RegExp(`</${n}>$`,"i"),`</${s}>`)}))}window[a]=!0})(e),e[b])return e[b];const i=w({target:e}),n=()=>{i(),delete e[b]},o=Object.assign(n,{cleanup:n,update:()=>y(e)});return Object.defineProperty(e,b,{configurable:!0,value:o}),o},f=document.currentScript;y(f?f.getRootNode():document)}();
</script></foreignObject></svg></div><script>/*!! License: https://unpkg.com/@marp-team/marp-cli@4.2.3/lib/bespoke.js.LICENSE.txt */
!function(){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t,n,r=(n||(n=1,t={from:function(e,t){var n,r=1===(e.parent||e).nodeType?e.parent||e:document.querySelector(e.parent||e),o=[].filter.call("string"==typeof e.slides?r.querySelectorAll(e.slides):e.slides||r.children,function(e){return"SCRIPT"!==e.nodeName}),a={},i=function(e,t){return(t=t||{}).index=o.indexOf(e),t.slide=e,t},s=function(e,t){a[e]=(a[e]||[]).filter(function(e){return e!==t})},c=function(e,t){return(a[e]||[]).reduce(function(e,n){return e&&!1!==n(t)},!0)},l=function(e,t){o[e]&&(n&&c("deactivate",i(n,t)),n=o[e],c("activate",i(n,t)))},d=function(e,t){var r=o.indexOf(n)+e;c(e>0?"next":"prev",i(n,t))&&l(r,t)},u={off:s,on:function(e,t){return(a[e]||(a[e]=[])).push(t),s.bind(null,e,t)},fire:c,slide:function(e,t){if(!arguments.length)return o.indexOf(n);c("slide",i(o[e],t))&&l(e,t)},next:d.bind(null,1),prev:d.bind(null,-1),parent:r,slides:o,destroy:function(e){c("destroy",i(n,e)),a={}}};return(t||[]).forEach(function(e){e(u)}),n||l(0),u}}),t),o=e(r);const a=document.body,i=(...e)=>history.replaceState(...e),s="",c="presenter",l="next",d=["",c,l],u="bespoke-marp-",f=`data-${u}`,m=(e,{protocol:t,host:n,pathname:r,hash:o}=location)=>{const a=e.toString();return`${t}//${n}${r}${a?"?":""}${a}${o}`},g=()=>a.dataset.bespokeView,p=e=>new URLSearchParams(location.search).get(e),v=(e,t={})=>{const n={location,setter:i,...t},r=new URLSearchParams(n.location.search);for(const t of Object.keys(e)){const n=e[t];"string"==typeof n?r.set(t,n):r.delete(t)}try{n.setter({...window.history.state??{}},"",m(r,n.location))}catch(e){console.error(e)}},h=(()=>{const e="bespoke-marp";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}})(),y=e=>{try{return localStorage.getItem(e)}catch{return null}},b=(e,t)=>{try{return localStorage.setItem(e,t),!0}catch{return!1}},w=e=>{try{return localStorage.removeItem(e),!0}catch{return!1}},x=(e,t)=>{const n="aria-hidden";t?e.setAttribute(n,"true"):e.removeAttribute(n)},k=e=>{e.parent.classList.add(`${u}parent`),e.slides.forEach(e=>e.classList.add(`${u}slide`)),e.on("activate",t=>{const n=`${u}active`,r=t.slide,o=r.classList,a=!o.contains(n);if(e.slides.forEach(e=>{e.classList.remove(n),x(e,!0)}),o.add(n),x(r,!1),a){const e=`${n}-ready`;o.add(e),document.body.clientHeight,o.remove(e)}})},$=e=>{let t=0,n=0;Object.defineProperty(e,"fragments",{enumerable:!0,value:e.slides.map(e=>[null,...e.querySelectorAll("[data-marpit-fragment]")])});const r=r=>void 0!==e.fragments[t][n+r],o=(r,o)=>{t=r,n=o,e.fragments.forEach((e,t)=>{e.forEach((e,n)=>{if(null==e)return;const a=t<r||t===r&&n<=o;e.setAttribute(`${f}fragment`,(a?"":"in")+"active");const i=`${f}current-fragment`;t===r&&n===o?e.setAttribute(i,"current"):e.removeAttribute(i)})}),e.fragmentIndex=o;const a={slide:e.slides[r],index:r,fragments:e.fragments[r],fragmentIndex:o};e.fire("fragment",a)};e.on("next",({fragment:a=!0})=>{if(a){if(r(1))return o(t,n+1),!1;const a=t+1;e.fragments[a]&&o(a,0)}else{const r=e.fragments[t].length;if(n+1<r)return o(t,r-1),!1;const a=e.fragments[t+1];a&&o(t+1,a.length-1)}}),e.on("prev",({fragment:a=!0})=>{if(r(-1)&&a)return o(t,n-1),!1;const i=t-1;e.fragments[i]&&o(i,e.fragments[i].length-1)}),e.on("slide",({index:t,fragment:n})=>{let r=0;if(void 0!==n){const o=e.fragments[t];if(o){const{length:e}=o;r=-1===n?e-1:Math.min(Math.max(n,0),e-1)}}o(t,r)}),o(0,0)},E=document,L=()=>!(!E.fullscreenEnabled&&!E.webkitFullscreenEnabled),S=()=>!(!E.fullscreenElement&&!E.webkitFullscreenElement),P=e=>{e.fullscreen=()=>{L()&&(async()=>{S()?(E.exitFullscreen||E.webkitExitFullscreen)?.call(E):((e=E.body)=>{(e.requestFullscreen||e.webkitRequestFullscreen)?.call(e)})()})()},document.addEventListener("keydown",t=>{"f"!==t.key&&"F11"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!L()||(e.fullscreen(),t.preventDefault())})},_=`${u}inactive`,T=(e=2e3)=>({parent:t,fire:n})=>{const r=t.classList,o=e=>n(`marp-${e?"":"in"}active`);let a;const i=()=>{a&&clearTimeout(a),a=setTimeout(()=>{r.add(_),o()},e),r.contains(_)&&(r.remove(_),o(!0))};for(const e of["mousedown","mousemove","touchend"])document.addEventListener(e,i);setTimeout(i,0)},I=["AUDIO","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO"],M=e=>{e.parent.addEventListener("keydown",e=>{if(!e.target)return;const t=e.target;(I.includes(t.nodeName)||"true"===t.contentEditable)&&e.stopPropagation()})},O=e=>{window.addEventListener("load",()=>{for(const t of e.slides){const e=t.querySelector("marp-auto-scaling, [data-auto-scaling], [data-marp-fitting]");t.setAttribute(`${f}load`,e?"":"hideable")}})},A=({interval:e=250}={})=>t=>{document.addEventListener("keydown",e=>{if(" "===e.key&&e.shiftKey)t.prev();else if("ArrowLeft"===e.key||"ArrowUp"===e.key||"PageUp"===e.key)t.prev({fragment:!e.shiftKey});else if(" "!==e.key||e.shiftKey)if("ArrowRight"===e.key||"ArrowDown"===e.key||"PageDown"===e.key)t.next({fragment:!e.shiftKey});else if("End"===e.key)t.slide(t.slides.length-1,{fragment:-1});else{if("Home"!==e.key)return;t.slide(0)}else t.next();e.preventDefault()});let n,r,o=0;t.parent.addEventListener("wheel",a=>{let i=!1;const s=(e,t)=>{e&&(i=i||((e,t)=>((e,t)=>{const n="X"===t?"Width":"Height";return e[`client${n}`]<e[`scroll${n}`]})(e,t)&&((e,t)=>{const{overflow:n}=e,r=e[`overflow${t}`];return"auto"===n||"scroll"===n||"auto"===r||"scroll"===r})(getComputedStyle(e),t))(e,t)),e?.parentElement&&s(e.parentElement,t)};if(0!==a.deltaX&&s(a.target,"X"),0!==a.deltaY&&s(a.target,"Y"),i)return;a.preventDefault();const c=Math.sqrt(a.deltaX**2+a.deltaY**2);if(void 0!==a.wheelDelta){if(void 0===a.webkitForce&&Math.abs(a.wheelDelta)<40)return;if(a.deltaMode===a.DOM_DELTA_PIXEL&&c<4)return}else if(a.deltaMode===a.DOM_DELTA_PIXEL&&c<12)return;r&&clearTimeout(r),r=setTimeout(()=>{n=0},e);const l=Date.now()-o<e,d=c<=n;if(n=c,l||d)return;let u;(a.deltaX>0||a.deltaY>0)&&(u="next"),(a.deltaX<0||a.deltaY<0)&&(u="prev"),u&&(t[u](),o=Date.now())})},C=(e=`.${u}osc`)=>{const t=document.querySelector(e);if(!t)return()=>{};const n=(e,n)=>{t.querySelectorAll(`[${f}osc=${JSON.stringify(e)}]`).forEach(n)};return L()||n("fullscreen",e=>e.style.display="none"),h||n("presenter",e=>{e.disabled=!0,e.title="Presenter view is disabled due to restricted localStorage."}),e=>{t.addEventListener("click",t=>{if(t.target instanceof HTMLElement){const{bespokeMarpOsc:n}=t.target.dataset;n&&t.target.blur();const r={fragment:!t.shiftKey};"next"===n?e.next(r):"prev"===n?e.prev(r):"fullscreen"===n?e?.fullscreen():"presenter"===n&&e.openPresenterView()}}),e.parent.appendChild(t),e.on("activate",({index:t})=>{n("page",n=>n.textContent=`Page ${t+1} of ${e.slides.length}`)}),e.on("fragment",({index:t,fragments:r,fragmentIndex:o})=>{n("prev",e=>e.disabled=0===t&&0===o),n("next",n=>n.disabled=t===e.slides.length-1&&o===r.length-1)}),e.on("marp-active",()=>x(t,!1)),e.on("marp-inactive",()=>x(t,!0)),L()&&(e=>{for(const t of["","webkit"])E.addEventListener(t+"fullscreenchange",e)})(()=>n("fullscreen",e=>e.classList.toggle("exit",L()&&S())))}},D=e=>{window.addEventListener("message",t=>{if(t.origin!==window.origin)return;const[n,r]=t.data.split(":");if("navigate"===n){const[t,n]=r.split(",");let o=Number.parseInt(t,10),a=Number.parseInt(n,10)+1;a>=e.fragments[o].length&&(o+=1,a=0),e.slide(o,{fragment:a})}})};var N,B,q,K,F,j,V,U={exports:{}},X=(N||(N=1,U.exports=(B=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],q=function(e){return String(e).replace(/[&<>"']/g,function(e){return"&"+K[e]+";"})},K={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},F="dangerouslySetInnerHTML",j={className:"class",htmlFor:"for"},V={},function(e,t){var n=[],r="";t=t||{};for(var o=arguments.length;o-- >2;)n.push(arguments[o]);if("function"==typeof e)return t.children=n.reverse(),e(t);if(e){if(r+="<"+e,t)for(var a in t)!1!==t[a]&&null!=t[a]&&a!==F&&(r+=" "+(j[a]?j[a]:q(a))+'="'+q(t[a])+'"');r+=">"}if(-1===B.indexOf(e)){if(t[F])r+=t[F].__html;else for(;n.length;){var i=n.pop();if(i)if(i.pop)for(var s=i.length;s--;)n.push(i[s]);else r+=!0===V[i]?i:q(i)}r+=e?"</"+e+">":""}return V[r]=!0,r})),U.exports),H=e(X);const R=({children:e})=>H(null,null,...e),W=`${u}presenter-`,J={container:`${W}container`,dragbar:`${W}dragbar-container`,next:`${W}next`,nextContainer:`${W}next-container`,noteContainer:`${W}note-container`,noteWrapper:`${W}note-wrapper`,noteButtons:`${W}note-buttons`,infoContainer:`${W}info-container`,infoPage:`${W}info-page`,infoPageText:`${W}info-page-text`,infoPagePrev:`${W}info-page-prev`,infoPageNext:`${W}info-page-next`,noteButtonsBigger:`${W}note-bigger`,noteButtonsSmaller:`${W}note-smaller`,infoTime:`${W}info-time`,infoTimer:`${W}info-timer`},Y=e=>{const{title:t}=document;document.title="[Presenter view]"+(t?` - ${t}`:"");const n={},r=e=>(n[e]=n[e]||document.querySelector(`.${e}`),n[e]);document.body.appendChild((e=>{const t=document.createElement("div");return t.className=J.container,t.appendChild(e),t.insertAdjacentHTML("beforeend",H(R,null,H("div",{class:J.nextContainer},H("iframe",{class:J.next,src:"?view=next"})),H("div",{class:J.dragbar}),H("div",{class:J.noteContainer},H("div",{class:J.noteWrapper}),H("div",{class:J.noteButtons},H("button",{class:J.noteButtonsSmaller,tabindex:"-1",title:"Smaller notes font size"},"Smaller notes font size"),H("button",{class:J.noteButtonsBigger,tabindex:"-1",title:"Bigger notes font size"},"Bigger notes font size"))),H("div",{class:J.infoContainer},H("div",{class:J.infoPage},H("button",{class:J.infoPagePrev,tabindex:"-1",title:"Previous"},"Previous"),H("span",{class:J.infoPageText}),H("button",{class:J.infoPageNext,tabindex:"-1",title:"Next"},"Next")),H("time",{class:J.infoTime,title:"Current time"}),H("time",{class:J.infoTimer,title:"Timer"})))),t})(e.parent)),(e=>{let t=!1;r(J.dragbar).addEventListener("mousedown",()=>{t=!0,r(J.dragbar).classList.add("active")}),window.addEventListener("mouseup",()=>{t=!1,r(J.dragbar).classList.remove("active")}),window.addEventListener("mousemove",e=>{if(!t)return;const n=e.clientX/document.documentElement.clientWidth*100;r(J.container).style.setProperty("--bespoke-marp-presenter-split-ratio",`${Math.max(0,Math.min(100,n))}%`)}),r(J.nextContainer).addEventListener("click",()=>e.next());const n=r(J.next),o=(a=n,(e,t)=>a.contentWindow?.postMessage(`navigate:${e},${t}`,"null"===window.origin?"*":window.origin));var a;n.addEventListener("load",()=>{r(J.nextContainer).classList.add("active"),o(e.slide(),e.fragmentIndex),e.on("fragment",({index:e,fragmentIndex:t})=>o(e,t))});const i=document.querySelectorAll(".bespoke-marp-note");i.forEach(e=>{e.addEventListener("keydown",e=>e.stopPropagation()),r(J.noteWrapper).appendChild(e)}),e.on("activate",()=>i.forEach(t=>t.classList.toggle("active",t.dataset.index==e.slide())));let s=0;const c=e=>{s=Math.max(-5,s+e),r(J.noteContainer).style.setProperty("--bespoke-marp-note-font-scale",(1.2**s).toFixed(4))},l=()=>c(1),d=()=>c(-1),u=r(J.noteButtonsBigger),f=r(J.noteButtonsSmaller);u.addEventListener("click",()=>{u.blur(),l()}),f.addEventListener("click",()=>{f.blur(),d()}),document.addEventListener("keydown",e=>{"+"===e.key&&l(),"-"===e.key&&d()},!0),e.on("activate",({index:t})=>{r(J.infoPageText).textContent=`${t+1} / ${e.slides.length}`});const m=r(J.infoPagePrev),g=r(J.infoPageNext);m.addEventListener("click",t=>{m.blur(),e.prev({fragment:!t.shiftKey})}),g.addEventListener("click",t=>{g.blur(),e.next({fragment:!t.shiftKey})}),e.on("fragment",({index:t,fragments:n,fragmentIndex:r})=>{m.disabled=0===t&&0===r,g.disabled=t===e.slides.length-1&&r===n.length-1});let p=new Date;const v=()=>{const e=new Date,t=e=>`${Math.floor(e)}`.padStart(2,"0"),n=e.getTime()-p.getTime(),o=t(n/1e3%60),a=t(n/1e3/60%60),i=t(n/36e5%24);r(J.infoTime).textContent=e.toLocaleTimeString(),r(J.infoTimer).textContent=`${i}:${a}:${o}`};v(),setInterval(v,250),r(J.infoTimer).addEventListener("click",()=>{p=new Date})})(e)},z=e=>{if(!(e=>e.syncKey&&"string"==typeof e.syncKey)(e))throw new Error("The current instance of Bespoke.js is invalid for Marp bespoke presenter plugin.");Object.defineProperties(e,{openPresenterView:{enumerable:!0,value:G},presenterUrl:{enumerable:!0,get:Q}}),h&&document.addEventListener("keydown",t=>{"p"!==t.key||t.altKey||t.ctrlKey||t.metaKey||(t.preventDefault(),e.openPresenterView())})};function G(){const{max:e,floor:t}=Math,n=e(t(.85*window.innerWidth),640),r=e(t(.85*window.innerHeight),360);return window.open(this.presenterUrl,W+this.syncKey,`width=${n},height=${r},menubar=no,toolbar=no`)}function Q(){const e=new URLSearchParams(location.search);return e.set("view","presenter"),e.set("sync",this.syncKey),m(e)}const Z=e=>{const t=g();return t===l&&e.appendChild(document.createElement("span")),{[s]:z,[c]:Y,[l]:D}[t]},ee=e=>{e.on("activate",t=>{document.querySelectorAll(".bespoke-progress-parent > .bespoke-progress-bar").forEach(n=>{n.style.flexBasis=100*t.index/(e.slides.length-1)+"%"})})},te=e=>{const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t},ne=(e={})=>{const t={history:!0,...e};return e=>{let n=!0;const r=e=>{const t=n;try{return n=!0,e()}finally{n=t}},o=(t={fragment:!0})=>{let n=t.fragment?te(p("f")||""):null;((t,n)=>{const{min:r,max:o}=Math,{fragments:a,slides:i}=e,s=o(0,r(t,i.length-1)),c=o(0,r(n||0,a[s].length-1));s===e.slide()&&c===e.fragmentIndex||e.slide(s,{fragment:c})})((()=>{if(location.hash){const[t]=location.hash.slice(1).split(":~:");if(/^\d+$/.test(t))return(te(t)??1)-1;const r=document.getElementById(t)||document.querySelector(`a[name="${CSS.escape(t)}"]`);if(r){const{length:t}=e.slides;for(let o=0;o<t;o+=1)if(e.slides[o].contains(r)){const t=e.fragments?.[o],a=r.closest("[data-marpit-fragment]");if(t&&a){const e=t.indexOf(a);e>=0&&(n=e)}return o}}}return 0})(),n)};e.on("fragment",({index:e,fragmentIndex:r})=>{n||v({f:0===r||r.toString()},{location:{...location,hash:`#${e+1}`},setter:(...e)=>t.history?history.pushState(...e):history.replaceState(...e)})}),setTimeout(()=>{o(),window.addEventListener("hashchange",()=>r(()=>{o({fragment:!1}),v({f:void 0})})),window.addEventListener("popstate",()=>{n||r(()=>o())}),n=!1},0)}},re=(e={})=>{const t=e.key||window.history.state?.marpBespokeSyncKey||Math.random().toString(36).slice(2),n=`bespoke-marp-sync-${t}`;var r;r={marpBespokeSyncKey:t},v({},{setter:(e,...t)=>i({...e,...r},...t)});const o=()=>{const e=y(n);return e?JSON.parse(e):Object.create(null)},a=e=>{const t=o(),r={...t,...e(t)};return b(n,JSON.stringify(r)),r},s=()=>{window.removeEventListener("pageshow",s),a(e=>({reference:(e.reference||0)+1}))};return e=>{s(),Object.defineProperty(e,"syncKey",{value:t,enumerable:!0});let r=!0;setTimeout(()=>{e.on("fragment",e=>{r&&a(()=>({index:e.index,fragmentIndex:e.fragmentIndex}))})},0),window.addEventListener("storage",t=>{if(t.key===n&&t.oldValue&&t.newValue){const n=JSON.parse(t.oldValue),o=JSON.parse(t.newValue);if(n.index!==o.index||n.fragmentIndex!==o.fragmentIndex)try{r=!1,e.slide(o.index,{fragment:o.fragmentIndex,forSync:!0})}finally{r=!0}}});const i=()=>{const{reference:e}=o();void 0===e||e<=1?w(n):a(()=>({reference:e-1}))};window.addEventListener("pagehide",e=>{e.persisted&&window.addEventListener("pageshow",s),i()}),e.on("destroy",i)}},{PI:oe,abs:ae,sqrt:ie,atan2:se}=Math,ce={passive:!0},le=({slope:e=-.7,swipeThreshold:t=30}={})=>n=>{let r;const o=n.parent,a=e=>{const t=o.getBoundingClientRect();return{x:e.pageX-(t.left+t.right)/2,y:e.pageY-(t.top+t.bottom)/2}};o.addEventListener("touchstart",({touches:e})=>{r=1===e.length?a(e[0]):void 0},ce),o.addEventListener("touchmove",e=>{if(r)if(1===e.touches.length){e.preventDefault();const t=a(e.touches[0]),n=t.x-r.x,o=t.y-r.y;r.delta=ie(ae(n)**2+ae(o)**2),r.radian=se(n,o)}else r=void 0}),o.addEventListener("touchend",o=>{if(r){if(r.delta&&r.delta>=t&&r.radian){const t=(r.radian-e+oe)%(2*oe)-oe;n[t<0?"next":"prev"](),o.stopPropagation()}r=void 0}},ce)},de=new Map;de.clear(),de.set("none",{backward:{both:void 0,incoming:void 0,outgoing:void 0},forward:{both:void 0,incoming:void 0,outgoing:void 0}});const ue={both:"",outgoing:"outgoing-",incoming:"incoming-"},fe={forward:"",backward:"-backward"},me=e=>`--marp-bespoke-transition-animation-${e}`,ge=e=>`--marp-transition-${e}`,pe=me("name"),ve=me("duration"),he=e=>new Promise(t=>{const n={},r=document.createElement("div"),o=e=>{r.remove(),t(e)};r.addEventListener("animationstart",()=>o(n)),Object.assign(r.style,{animationName:e,animationDuration:"1s",animationFillMode:"both",animationPlayState:"paused",position:"absolute",pointerEvents:"none"}),document.body.appendChild(r);const a=getComputedStyle(r).getPropertyValue(ge("duration"));a&&Number.parseFloat(a)>=0&&(n.defaultDuration=a),((e,t)=>{requestAnimationFrame(()=>{e.style.animationPlayState="running",requestAnimationFrame(()=>t(void 0))})})(r,o)}),ye=async e=>de.has(e)?de.get(e):(e=>{const t={},n=[];for(const[r,o]of Object.entries(ue))for(const[a,i]of Object.entries(fe)){const s=`marp-${o}transition${i}-${e}`;n.push(he(s).then(e=>{t[a]=t[a]||{},t[a][r]=e?{...e,name:s}:void 0}))}return Promise.all(n).then(()=>t)})(e).then(t=>(de.set(e,t),t)),be=e=>Object.values(e).flatMap(Object.values).every(e=>!e),we=(e,{type:t,backward:n})=>{const r=e[n?"backward":"forward"],o=(()=>{const e=r[t],n=e=>({[pe]:e.name});if(e)return n(e);if(r.both){const e=n(r.both);return"incoming"===t&&(e[me("direction")]="reverse"),e}})();return!o&&n?we(e,{type:t,backward:!1}):o||{[pe]:"__bespoke_marp_transition_no_animation__"}},xe=e=>{if(e)try{const t=JSON.parse(e);if((e=>{if("object"!=typeof e)return!1;const t=e;return"string"==typeof t.name&&(void 0===t.duration||"string"==typeof t.duration)})(t))return t}catch{}},ke="_tSId",$e="_tA",Ee="bespoke-marp-transition-warming-up",Le=window.matchMedia("(prefers-reduced-motion: reduce)"),Se="__bespoke_marp_transition_reduced_outgoing__",Pe="__bespoke_marp_transition_reduced_incoming__",_e={forward:{both:void 0,incoming:{name:Pe},outgoing:{name:Se}},backward:{both:void 0,incoming:{name:Pe},outgoing:{name:Se}}},Te=e=>{if(!document.startViewTransition)return;const t=t=>(void 0!==t&&(e._tD=t),e._tD);let n;t(!1),((...e)=>{CSS.registerProperty({name:ge("duration"),syntax:"<time>",inherits:!0,initialValue:"-1s"});const t=[...new Set(e).values()];return Promise.all(t.map(e=>ye(e))).then()})(...Array.from(document.querySelectorAll("section[data-transition], section[data-transition-back]")).flatMap(e=>[e.dataset.transition,e.dataset.transitionBack].flatMap(e=>{const t=xe(e);return[t?.name,t?.builtinFallback?`__builtin__${t.name}`:void 0]}).filter(e=>!!e))).then(()=>{document.querySelectorAll("style").forEach(e=>{e.innerHTML=e.innerHTML.replace(/--marp-transition-duration:[^;}]*[;}]/g,e=>e.slice(0,-1)+"!important"+e.slice(-1))})});const r=(n,{back:r,cond:o})=>a=>{const i=t();if(i)return!!a[$e]||!("object"!=typeof i||(i.skipTransition(),!a.forSync));if(!o(a))return!0;const s=e.slides[e.slide()],c=()=>a.back??r,l="data-transition"+(c()?"-back":""),d=s.querySelector(`section[${l}]`);if(!d)return!0;const u=xe(d.getAttribute(l)??void 0);return!u||((async(e,{builtinFallback:t=!0}={})=>{let n=await ye(e);if(be(n)){if(!t)return;return n=await ye(`__builtin__${e}`),be(n)?void 0:n}return n})(u.name,{builtinFallback:u.builtinFallback}).then(e=>{if(!e){t(!0);try{n(a)}finally{t(!1)}return}let r=e;Le.matches&&(console.warn("Use a constant animation to transition because preferring reduced motion by viewer has detected."),r=_e);const o=document.getElementById(ke);o&&o.remove();const i=document.createElement("style");i.id=ke,document.head.appendChild(i),((e,t)=>{const n=[`:root{${ge("direction")}:${t.backward?-1:1};}`,":root:has(.bespoke-marp-inactive){cursor:none;}"],r=t=>{const n=e[t].both?.defaultDuration||e[t].outgoing?.defaultDuration||e[t].incoming?.defaultDuration;return"forward"===t?n:n||r("forward")},o=t.duration||r(t.backward?"backward":"forward");void 0!==o&&n.push(`::view-transition-group(*){${ve}:${o};}`);const a=e=>Object.entries(e).map(([e,t])=>`${e}:${t};`).join("");return n.push(`::view-transition-old(root){${a(we(e,{...t,type:"outgoing"}))}}`,`::view-transition-new(root){${a(we(e,{...t,type:"incoming"}))}}`),n})(r,{backward:c(),duration:u.duration}).forEach(e=>i.sheet?.insertRule(e));const s=document.documentElement.classList;s.add(Ee);let l=!1;const d=()=>{l||(n(a),l=!0,s.remove(Ee))},f=()=>{t(!1),i.remove(),s.remove(Ee)};try{t(!0);const e=document.startViewTransition(d);t(e),e.finished.finally(f)}catch(e){console.error(e),d(),f()}}),!1)};e.on("prev",r(t=>e.prev({...t,[$e]:!0}),{back:!0,cond:e=>e.index>0&&!((e.fragment??1)&&n.fragmentIndex>0)})),e.on("next",r(t=>e.next({...t,[$e]:!0}),{cond:t=>t.index+1<e.slides.length&&!(n.fragmentIndex+1<n.fragments.length)})),setTimeout(()=>{e.on("slide",r(t=>e.slide(t.index,{...t,[$e]:!0}),{cond:t=>{const n=e.slide();return t.index!==n&&(t.back=t.index<n,!0)}}))},0),e.on("fragment",e=>{n=e})};let Ie;const Me=()=>(void 0===Ie&&(Ie="wakeLock"in navigator&&navigator.wakeLock),Ie),Oe=async()=>{const e=Me();if(e)try{return await e.request("screen")}catch(e){console.warn(e)}return null},Ae=async()=>{if(!Me())return;let e;const t=()=>{e&&"visible"===document.visibilityState&&Oe()};for(const e of["visibilitychange","fullscreenchange"])document.addEventListener(e,t);return e=await Oe(),e};((e=document.getElementById(":$p"))=>{(()=>{const e=p("view");a.dataset.bespokeView=e===l||e===c?e:""})();const t=(e=>{const t=p(e);return v({[e]:void 0}),t})("sync")||void 0;o.from(e,((...e)=>{const t=d.findIndex(e=>g()===e);return e.map(([e,n])=>e[t]&&n).filter(e=>e)})([[1,1,0],re({key:t})],[[1,1,1],Z(e)],[[1,1,0],M],[[1,1,1],k],[[1,0,0],T()],[[1,1,1],O],[[1,1,1],ne({history:!1})],[[1,1,0],A()],[[1,1,0],P],[[1,0,0],ee],[[1,1,0],le()],[[1,0,0],C()],[[1,0,0],Te],[[1,1,1],$],[[1,1,0],Ae]))})()}();</script></body></html>